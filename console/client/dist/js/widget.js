/*! For license information please see widget.js.LICENSE.txt */
(()=>{var e={"./js/com/genb/base/components/RadioButtonsGroup.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{RadioButtonsGroup:()=>r});var i=s("./js/com/genb/base/controller/UIView.js");s("./js/com/genb/base/components/ToggleButton.js");class r extends i.UIView{constructor(){super(),this.elements=[]}addRadioButton(e){this.elements.push(e),e.element.addEventListener("click",(()=>{this.disableAll(),e.enable()}),!1)}disableAll(){this.elements.forEach((e=>{e.disable()}))}}},"./js/com/genb/base/components/ToggleButton.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{ToggleButton:()=>r});var i=s("./js/com/genb/base/controller/UIView.js");class r extends i.UIView{constructor(e){super(),this.element=e,this.enabled=!1,this.element.addEventListener("click",(()=>{this.toggle()}),!1)}enable(){this.enabled=!0,this.element.classList.add("js-enabled")}disable(){this.enabled=!1,this.element.classList.remove("js-enabled","enabled")}toggle(){this.enabled?this.disable():this.enable()}}},"./js/com/genb/base/controller/ObservableController.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{ObservableController:()=>r});var i=s("./js/com/genb/base/service/EventEmitter.js");class r{constructor(){this.observable=new i.EventEmitter}addListener(e,t){this.observable.addListener(e,t)}removeListener(e,t){this.observable.removeListener(e,t)}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];this.observable.emit(e,...s)}}},"./js/com/genb/base/controller/UIView.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{UIView:()=>o});var i=s("./js/com/genb/base/controller/ObservableController.js"),r=s("./js/com/genb/base/utils/HTMLUtils.js");class o extends i.ObservableController{uiGet(e){return r.HTMLUtils.get(e)}uiExists(e){return r.HTMLUtils.exists(e)}uiArray(e){return r.HTMLUtils.array(e)}removeListeners(e){var t=this.uiGet(e),s=t.cloneNode(!0);t.parentNode.replaceChild(s,t)}removeElementListeners(e){var t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)}removeListListeners(e){this.uiArray(e).forEach((e=>{this.removeElementListeners(e)}))}}},"./js/com/genb/base/service/EventEmitter.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{EventEmitter:()=>i});class i{constructor(){this.listeners=new Map}addListener(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}removeListener(e,t){let s,i=this.listeners.get(e);return!!(i&&i.length&&(s=i.reduce(((e,s,i)=>this.isFunction(s)&&s===t?e=i:e),-1),s>-1))&&(i.splice(s,1),this.listeners.set(e,i),!0)}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];let r=this.listeners.get(e);return!(!r||!r.length)&&(r.forEach((e=>{e(...s)})),!0)}isFunction(e){return"function"==typeof e||!1}}},"./js/com/genb/base/service/FormService.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{FormService:()=>n});var i=s("./js/com/genb/base/service/EventEmitter.js"),r=s("../node_modules/js-cookie/src/js.cookie.js"),o=s.n(r);class n extends i.EventEmitter{getAsXMLHttpRequest(e){return this.sendAsXMLHttpRequest("GET",[],e)}postAsXMLHttpRequest(e,t){return this.sendAsXMLHttpRequest("POST",e,t)}sendAsXMLHttpRequest(e,t,s){let i=new FormData;for(const[e,s]of Object.entries(t))i.append(e,s);return new Promise(((t,r)=>{let n=new XMLHttpRequest;n.open(e,s,!0),n.addEventListener("load",(()=>{[200,201].includes(n.status)&&t(n.responseText),r(n.responseText)}));var a=o().get("csrftoken");"undefined"!==a&&n.setRequestHeader("X-CSRFToken",a),n.send(i)}))}sendAsXMLHttpFormEncodedRequest(e,t){let s="";return e.forEach((e=>{s=`${s}${e.name}=${e.value}&`})),new Promise((e=>{let i=new XMLHttpRequest;i.open("POST",t,!0),i.addEventListener("load",(()=>{e(i.responseText)})),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(s)}))}sendAsForm(e,t){let s=`<form id="__form__" action='${t}' method="POST" enctype="multipart/form-data">`;var i=o().get("csrftoken");"undefined"!==i&&(s+=`<input type="hidden" name="csrfmiddlewaretoken" value="${i}">`);for(const[t,i]of Object.entries(e))s+=`<input type="hidden" name="${t}" value='${i}'>`;s+="</form>",document.body.insertAdjacentHTML("beforeend",s);document.getElementById("__form__").submit()}}},"./js/com/genb/base/utils/BaseUtils.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{BaseUtils:()=>i});class i{static isObjectDefined(e){try{return null!=e}catch(e){return!1}}static isPage(e){const t=document.querySelector("meta[property='emd:page']");return!!i.isObjectDefined(t)&&t.attributes.content.value===e}static get hostname(){return window.location.hostname}log(e){console.log(e)}}},"./js/com/genb/base/utils/HTMLUtils.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{HTMLUtils:()=>r});var i=s("./js/com/genb/base/utils/BaseUtils.js");class r{static get(e){const t=document.querySelector(e);return i.BaseUtils.isObjectDefined(t)||console.warn(`HTMLUtils::get Element "${e}" is not defined.`),t}static exists(e){const t=document.querySelector(e);return i.BaseUtils.isObjectDefined(t)}static getForm(){return r.get("form")}static getValueByName(e){return this.get(`*[name="${e}"]`).value}static getInputByName(e){return this.get(`input[name="${e}"]`)}static getInputByClassName(e){return this.get(`input.${e}`)}static getSelectByName(e){return this.get(`select[name="${e}"]`)}static getSelectByClassName(e){return this.get(`select.${e}`)}static getInputValueByName(e){return this.getInputByName(e).value}static getCheckboxValueByName(e){return this.getInputByName(e).checked?"true":"false"}static setInputValueByName(e,t){const s=this.getInputByName(e);i.BaseUtils.isObjectDefined(s)?s.value=t:console.warn(`setInputValueByName:: Element '${e}' is not defined.`)}static getSelectValueByName(e){return this.getSelectByName(e).value}static getSelectTextByName(e){return this.getSelectByName(e).selectedOptions[0].text}static setSelectValueByName(e,t){const s=this.getSelectByName(e);i.BaseUtils.isObjectDefined(s)?s.value=t:console.warn(`setSelectValueByName:: Element '${e}' is not defined.`)}static getInputValueByClassName(e){return this.getInputByClassName(e).value}static getSelectValueByClassName(e){return this.getSelectByClassName(e).value}static list(e){const t=document.querySelectorAll(e);return i.BaseUtils.isObjectDefined(t)||console.warn(`Elements "${e}" are not defined.`),t}static array(e){return Array.from(r.list(e))}static firstToHTMLElement(e){if(e.length>0)return e[0]}static activate(e){const t=r.get(e);r.activateElement(t)}static activateElement(e){e.classList.add("js-active")}static deactivate(e){const t=r.get(e);r.deactivateElement(t)}static deactivateElement(e){e.classList.remove("js-active")}static copyToClipboard(e){function t(t){t.clipboardData.setData("text/html",e),t.clipboardData.setData("text/plain",e),t.preventDefault()}document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t)}static decodeHtml(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}static removeAllEventListeners(e){const t=document.querySelector(e),s=t.cloneNode(t);t.parentNode.replaceChild(s,t)}static removeAllEventListenersFromElement(e){const t=e.cloneNode(e);e.parentNode.replaceChild(t,e)}static setCookie(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"/";const r=new Date(Date.now()+864e5*s).toUTCString();document.cookie=e+"="+encodeURIComponent(t)+"; expires="+r+"; path="+i}static getCookie(e){return document.cookie.split("; ").reduce(((t,s)=>{const i=s.split("=");return i[0]===e?decodeURIComponent(i[1]):t}),"")}static deleteCookie(e,t){this.setCookie(e,"",-1,t)}}},"./js/com/genb/base/utils/StringUtils.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{StringUtils:()=>r});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js");class r{static isDefined(e){return"string"==typeof e}static isEmpty(e){return"string"==typeof e&&0===e.length}static isNotEmpty(e){return!this.isEmpty(e)}static equals(e,t){return e===t}static getUID(){return(new Date).getTime().toString()}static isEmailValid(e){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)}static isIpAddressValid(e){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)}static isUrlValid(e){return/((http|ftp|https):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/.test(e)}static isNumber(e){return/^-?\d*[\.]?\d+$/.test(e)}static isCurrency(e){return/(?=.)^\$?(([1-9][0-9]{0,2}(,[0-9]{3})*)|[0-9]+)?(\.[0-9]{1,2})?$/.test(e)}static extractFormBuilderFormFieldType(e){return e.split(" ")[0].split("-")[1]}static extractFileNameFromPath(e){return e.replace(/^.*[\\\/]/,"")}static capitalize(e){return e.replace(/(^| )(\w)/g,(e=>e.toUpperCase()))}static toBoolean(e){return/(true|True|1)/g.test(e)}static stripFromQuotes(e){let t=/(['"]?)(.*)\1/.exec(e);return t.length>2?t[2]:r.EMPTY}static hashCode(e){return e.split("").reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0)}}(0,i.default)(r,"EMPTY",""),(0,i.default)(r,"URL_TARGET_BLANK","_blank"),(0,i.default)(r,"URL_TARGET_SELF","_self")},"./js/com/quickhellou/base/model/ApplicationSettings.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{ApplicationSettings:()=>i});class i{constructor(e){this.objs=JSON.parse(e),this.videoAppUrl=this.objs.video_app_url,this.consoleAppUrl=this.objs.console_app_url,this.webSocketServiceUrl=this.objs.ws_service_url,this.adminEmailAddress=this.objs.admin_email_address}getValue(e){return this.objs.filter((t=>t.property===e))[0].value}}},"./js/com/quickhellou/base/model/ComSessionStatus.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{ComSessionStatus:()=>i});class i{}i.STATUS_PENDING=1,i.STATUS_ENQUEUED=2,i.STATUS_MISSED=3,i.STATUS_CANCELLED=4,i.STATUS_REJECTED=5,i.STATUS_ACCEPTED=6,i.STATUS_COMPLETED=7},"./js/com/quickhellou/base/model/UserType.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{UserType:()=>i});class i{}i.ADMIN="admin",i.GUEST="guest"},"./js/com/quickhellou/base/services/ApiService.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{ApiService:()=>o});var i=s("./js/com/genb/base/service/FormService.js"),r=s("./js/com/quickhellou/base/model/ComSessionStatus.js");class o extends i.FormService{constructor(e){super(),this.baseUrl=e}getCurrentUser(){return this.getJson(`${this.baseUrl}/api/users/current/`)}getSettings(){return this.getJson(`${this.baseUrl}/api/settings/`)}getUserById(e){return this.getJson(`${this.baseUrl}/api/users/${e}/`)}getWidgetById(e){return this.getJson(`${this.baseUrl}/api/widgets/${e}/`)}getCommunicationRecord(e){return this.getJson(`${this.baseUrl}/api/appointments/${e}/`)}getJson(e){return this.getAsXMLHttpRequest(`${e}?format=json`)}createCall(e,t,s){const i={caller_name:e,caller_id:t,widget_uuid:s};return this.postAsXMLHttpRequest(i,`${this.baseUrl}/api/appointments/`)}rateComSession(e,t){return this.getAsXMLHttpRequest(`${this.baseUrl}/api/com_sessions/rate/${e}/${t}`)}cancelCall(e){return this.getAsXMLHttpRequest(`${this.baseUrl}/api/appointments/cancel/${e}/`)}getUuid(e){return this.getAsXMLHttpRequest(`${this.baseUrl}/api/com_sessions/room-uuid/${e}`)}setComSessionAsAccepted(e){return this.setComSessionStatus(e,r.ComSessionStatus.STATUS_ACCEPTED)}setComSessionAsRejected(e){return this.setComSessionStatus(e,r.ComSessionStatus.STATUS_REJECTED)}setComSessionAsCancelled(e){return this.setComSessionStatus(e,r.ComSessionStatus.STATUS_CANCELLED)}setComSessionAsCompleted(e){return this.setComSessionStatus(e,r.ComSessionStatus.STATUS_COMPLETED)}setComSessionAsEnqueued(e){return this.setComSessionStatus(e,r.ComSessionStatus.STATUS_ENQUEUED)}setComSessionStatus(e,t){return this.getAsXMLHttpRequest(`${this.baseUrl}/api/com_sessions/status/${e}/${t}`)}getPendingSessions(){return this.getAsXMLHttpRequest(`${this.baseUrl}/api/com_sessions/pending/1`)}}},"./js/com/quickhellou/base/services/WebSocketService.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{WebSocketService:()=>o});var i=s("./js/com/genb/base/service/FormService.js"),r=s("./js/com/quickhellou/base/model/UserType.js");class o extends i.FormService{constructor(e){super(),this.url=e,this.isOpen=!1,this.openWebSocketConnection()}openWebSocketConnection(){return new Promise((e=>{this.websocket=new WebSocket(this.url),this.websocket.onopen=()=>{this.websocket.readyState===WebSocket.OPEN&&(this.isOpen=!0,this.attachWebSocketEventHandlers(),e())},this.websocket.onerror=e=>{3===e.currentTarget.readyState&&this.emit("connection_failure")}}))}attachWebSocketEventHandlers(){this.websocket.onmessage=e=>{this.handleMessageResponse(e.data)},this.websocket.onclose=()=>{this.isOpen=!1},this.websocket.onerror=e=>{console.log("websocket error",e)}}handleMessageResponse(e){if(""===e)return;const t=JSON.parse(e);if(""!==t.error)return void this.emit("error",t.error);if(""!==t.msg){const e=JSON.parse(t.msg);switch(e.type){case"response":case"send":this.handleNamedResponse(e.body);break;case"list-clients":this.emit("listUsers",e.body);break;default:console.log("Response type not found.")}}}handleNamedResponse(e){if(console.log("response",e),""===e)return;const t="string"==typeof e?JSON.parse(e):e;switch(t.name){case"register":this.emit("register",t.status);break;case o.REQUEST_CALL:this.emit("callRequest",t.user,t.userId,t.widget);break;case o.CANCEL_CALL:this.emit("callCancel",t.recordId);break;case o.ACCEPT_CALL_REQUEST:this.emit("callAccepted",t.uuid);break;case o.REJECT_CALL_REQUEST:this.emit("callRejected");break;case o.SEND_COMMUNICATION_RECORD:this.emit("communicationRecord",t.record);break;default:console.log("No named response found.")}}registerList(e,t,s){s.forEach((s=>{this.register(e,t,s.id)}))}registerOperatorsList(e,t){this.registerList(e,r.UserType.ADMIN,t)}deregisterList(e,t){t.forEach((t=>{this.deregister(e,t.id)}))}register(e,t,s){this.sendWebSocketMessage({cmd:"register",clientid:e,clienttype:t,roomid:s})}registerOperator(e,t){this.register(e,r.UserType.ADMIN,t)}registerGuest(e,t){this.register(e,r.UserType.GUEST,t)}deregister(e,t){this.sendWebSocketMessage({cmd:"deregister",clientid:e,roomid:t})}send(e,t){this.sendWebSocketMessage({cmd:o.SEND,clientid:e.uuid,roomid:e.client_board_id,msg:t})}sendToOther(e,t,s,i){this.sendWebSocketMessage({cmd:"send-to-other",clientid:e,roomid:s,otherid:t,msg:i})}listClients(e,t,s){this.sendWebSocketMessage({cmd:"list-clients",clientid:e,clienttype:t,roomid:s})}listGuests(e,t){this.listClients(e,r.UserType.GUEST,t)}listAdmins(e,t){this.listClients(e,r.UserType.ADMIN,t)}requestCall(e,t,s,i){this.sendToOther(t,s,i,JSON.stringify({type:"send",body:{name:o.REQUEST_CALL,user:e,userId:t,widget:i}}))}cancelCall(e,t,s,i){console.log("cancel call",e,t,s,i),this.sendToOther(t,s,i,JSON.stringify({type:"send",body:{name:o.CANCEL_CALL,recordId:e}}))}acceptCallRequest(e,t,s,i){this.sendToOther(e,t,s,JSON.stringify({type:"send",body:{name:o.ACCEPT_CALL_REQUEST,uuid:i}}))}rejectCallRequest(e,t,s){this.sendToOther(e,t,s,JSON.stringify({type:"send",body:{name:o.REJECT_CALL_REQUEST}}))}passCommunicationRecord(e,t,s,i){this.sendToOther(e,t,s,JSON.stringify({type:"send",body:{name:o.SEND_COMMUNICATION_RECORD,record:i}}))}async sendWebSocketMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.isOpen||await this.openWebSocketConnection(),e.roomtype="client_board",e.persistant=String(t),this.websocket.send(JSON.stringify(e))}}o.SEND="send",o.REQUEST_CALL="request-call",o.CANCEL_CALL="cancel-call",o.ACCEPT_CALL_REQUEST="accept-call-request",o.REJECT_CALL_REQUEST="reject-call-request",o.SEND_COMMUNICATION_RECORD="send-communication-record"},"./js/com/quickhellou/base/utils/QhUtils.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{QhUtils:()=>o});var i=s("./js/com/genb/base/utils/BaseUtils.js"),r=s("./js/com/genb/base/utils/StringUtils.js");class o{static isPage(e){const t=document.querySelector("meta[property='qh:view']");return!!i.BaseUtils.isObjectDefined(t)&&r.StringUtils.equals(t.attributes.content.value,e)}static getQhProperty(e){const t=document.querySelector(`meta[property='qh:${e}']`);return i.BaseUtils.isObjectDefined(t)?t.attributes.content.value:(console.warn(`QhUtils::getQhProperty No "${e}" property found.`),null)}static getQhPropertyObject(e){return JSON.parse(o.getQhProperty(e))}static inTestMode(){return r.StringUtils.equals(o.getQhProperty("developerMode"),"test")}static createUserId(e){return`${this.appUuid}${e}`}static extractUserId(e){return e.split(this.appUuid)[1]}static get appUuid(){return"faf8c9f7-99f7-4b9a-8ab8-c1ec416737e7"}}},"./js/com/quickhellou/widget/BadgeView.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{BadgeView:()=>r});var i=s("./js/com/genb/base/controller/UIView.js");s("./js/com/genb/base/utils/HTMLUtils.js");class r extends i.UIView{constructor(e){super(),this.service=e,this.element=document.getElementById("qh_w_frame"),this.extDispatcher=window.parent.document.QHDispatcher}async init(){this.service.addListener("listUsers",(e=>{this.onListUsers(!!e.length)})),this.service.addListener("admin",(e=>{this.onAdmin(e)}));this.uiGet(".widget_base").addEventListener("click",(()=>{this.emit("collapse"),this.extDispatcher.dispatchEvent(new CustomEvent("expand_schedule",{detail:{source:"badge"}}))})),this.service.addListener("callRejected",(()=>{this.onCallRejected()}))}onUserRegister(e){"ok"===e&&this.webSocketService.listAdmins(this.user.uuid,this.widget.uuid)}onListUsers(e){this.toggleBackgroundElementActiveState(e),e||this.toggleUserIconElements(!1),this.toggleTopState(!e)}onAdmin(e){""!==e.thumbnail&&(this.setIcon(e.thumbnail),this.toggleUserIconElements(!0))}onCallRejected(){this.toggleTopState(!0)}toggleUserIconElements(e){document.querySelector(".widget-outlook__alert").classList.toggle("js-active",e)}toggleBackgroundElementActiveState(e){document.querySelector(".widget-outlook__background-circle").classList.toggle("js-active",e)}setIcon(e){this.uiGet(".widget-outlook__admin-thumbnail").style.backgroundImage=`url(${this.service.consoleAppUrl}/media/${e})`,this.emit("setThumbnail",e),this.extDispatcher.dispatchEvent(new CustomEvent("setThumbnail",{detail:{thumbnailPath:e,source:"badge"}}))}toggleTopState(e){}setCallRequestIcon(){this.uiGet(".widget-outlook__icon img").src=`${this.service.consoleAppUrl}/static/images/call-request.svg`}setCallAcceptedIcon(){this.uiGet(".widget-outlook__icon img").src=`${this.service.consoleAppUrl}/static/images/call-accepted.svg`}}},"./js/com/quickhellou/widget/ContactInformationView.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{ContactInformationView:()=>o});var i=s("./js/com/genb/base/controller/UIView.js"),r=s("./js/com/genb/base/utils/HTMLUtils.js");class o extends i.UIView{constructor(e){super(),this.service=e,this.isExpanded=!1,this.element=document.querySelector(".contact-information"),this.extDispatcher=window.parent.document.QHDispatcher}async init(){}async load(e){await this.loadContactForm(e),this.initUI()}initUI(){document.querySelector(".widget-closer--contact-information").addEventListener("click",(()=>{this.extDispatcher.dispatchEvent(new CustomEvent("collapse",{detail:{source:"contact_information"}}))}));document.querySelectorAll(".contact-information__button--back").forEach((e=>{e.addEventListener("click",(()=>{this.extDispatcher.dispatchEvent(new CustomEvent("expand_schedule",{detail:{source:"contact_information"}}))}))}));const e=".contact-information__button--submit";if(this.uiExists(e)){r.HTMLUtils.removeAllEventListeners(e);this.uiGet(e).addEventListener("click",(()=>{this.sendContactForm().then((()=>{this.initUI()}))}))}}async loadContactForm(e){return new Promise(((t,s)=>{const i={datetime:e};this.service.getContactForm(i).then((e=>{document.querySelector(".contact-information").innerHTML=e,t()})).catch((e=>{s(e)}))}))}async sendContactForm(){const e=document.querySelector(".contact-information__form");return new Promise(((t,s)=>{const i={datetime:e.querySelector("input[name=datetime]").value,name:e.querySelector("input[name=name]").value,email_address:e.querySelector("input[name=email_address]").value,phone_number:e.querySelector("input[name=phone_number]").value,message:e.querySelector("textarea[name=message]").value};this.service.sendContactForm(i).then((e=>{document.querySelector(".contact-information").innerHTML=e,t()})).catch((e=>{s(e)}))}))}}},"./js/com/quickhellou/widget/ScheduleView.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{ScheduleView:()=>o});var i=s("./js/com/genb/base/controller/UIView.js"),r=s("./js/com/quickhellou/widget/Scheduler.js");class o extends i.UIView{constructor(e){super(),this.service=e,this.isExpanded=!1,this.element=document.querySelector(".widget--schedule"),this.extDispatcher=window.parent.document.QHDispatcher,this.scheduler=new r.Scheduler(this.service)}async init(){document.querySelector(".qh_widget-closer").addEventListener("click",(()=>{this.extDispatcher.dispatchEvent(new CustomEvent("collapse",{detail:{source:"schedule"}}))}));document.querySelector(".widget-extension__button--send-schedule").addEventListener("click",(()=>{let e="";const t=document.querySelector(".scheduler__time.js-enabled");t&&(e=document.querySelector(".scheduler__time.js-enabled").dataset.time),t&&this.extDispatcher.dispatchEvent(new CustomEvent("expand_contact",{detail:{source:"schedule",datetime:e}}))}))}toggleView(){this.isExpanded?this.collapseView():this.expandView()}expandView(){this.isExpanded=!0,this.element.classList.add("js-expanded"),this.scheduler.init()}collapseView(){this.isExpanded=!1,this.element.classList.remove("js-expanded")}}},"./js/com/quickhellou/widget/Scheduler.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{Scheduler:()=>n});var i=s("./js/com/genb/base/controller/UIView.js"),r=s("./js/com/genb/base/components/ToggleButton.js"),o=s("./js/com/genb/base/components/RadioButtonsGroup.js");class n extends i.UIView{constructor(e){super(),this.service=e,this.element=document.querySelector(".widget--schedule__scheduler"),this.currentPage=0}async init(){await this.loadCalendar(),this.pages=document.querySelectorAll(".scheduler__page").length;document.querySelector(".scheduler__pages-nav-button--next").addEventListener("click",(()=>{this.currentPage<this.pages-1&&this.moveToPage(++this.currentPage)}));document.querySelector(".scheduler__pages-nav-button--prev").addEventListener("click",(()=>{this.currentPage>0&&this.moveToPage(--this.currentPage)})),this.updatePageNavigation(),this.initDatetimeFields()}moveToPage(e){document.querySelector(".scheduler__pages").style.transform=`translate(-${100*e}%)`,this.updatePageNavigation()}updatePageNavigation(){const e=document.querySelector(".scheduler__pages-nav-button--next"),t=document.querySelector(".scheduler__pages-nav-button--prev");e.classList.remove("js-hidden"),t.classList.remove("js-hidden"),0===this.currentPage&&t.classList.add("js-hidden"),this.currentPage===this.pages-1&&e.classList.add("js-hidden")}initDatetimeFields(){const e=new o.RadioButtonsGroup;document.querySelectorAll(".scheduler__button--time").forEach((t=>{const s=new r.ToggleButton(t);e.addRadioButton(s),t.addEventListener("click",(()=>{this.handleTimeButtonToggle(t.dataset.time)}),!1)}))}handleTimeButtonToggle(e){document.querySelector("input[name=datetime]").value=e;document.querySelector(".widget-extension__button--send-schedule").classList.remove("disabled")}async loadCalendar(){return new Promise(((e,t)=>{this.service.getSchedulerCalendar().then((t=>{document.querySelector(".widget--schedule__datetime-controls").innerHTML=t,e()})).catch((e=>{t(e)}))}))}}},"./js/com/quickhellou/widget/WidgetExtensionView.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{WidgetExtensionView:()=>o});var i=s("./js/com/genb/base/controller/UIView.js"),r=s("./js/com/genb/base/utils/HTMLUtils.js");class o extends i.UIView{constructor(e){super(),this.service=e,this.element=this.uiGet("#qh_e_frame"),this.isExpanded=!1,this.videoMode=!1,this.anyOperatorActive=!1,this.extDispatcher=window.parent.document.QHDispatcher}async init(){this.service.addListener("admin",(e=>{this.onAdmin(e)})),this.service.addListener("listUsers",(e=>{this.anyOperatorActive=!!e.length,this.updateVideoCallUi()})),this.service.addListener("callAccepted",(e=>{this.onCallAccepted(e)})),this.service.addListener("callRejected",(()=>{this.onCallRejected()})),this.service.addListener("videochatSessionClose",(()=>{this.onHangUpVideoChat()}));const e=this.uiArray(".qh_rate-star");e.forEach(((t,s)=>{t.addEventListener("click",(()=>{for(let t=1;t<=e.length;t++){const e=this.uiGet(`.qh_rate-star:nth-child(${t})`);e.classList.remove("js-enabled,js-disabled"),t<=s+1?(e.classList.add("js-enabled"),e.classList.remove("js-disabled")):(e.classList.remove("js-enabled"),e.classList.add("js-disabled"))}this.service.rateComSession(s+1)}))})),this.initContactForm()}initContactForm(){const e=".widget-extension__button--send-contact";if(this.uiExists(e)){r.HTMLUtils.removeAllEventListeners(e);this.uiGet(e).addEventListener("click",(()=>{this.sendScheduleForm()}))}this.initInactiveOperatorCloser()}initStartVideoChatForm(){const e=".widget-extension__button--video-call";if(this.uiExists(e)){r.HTMLUtils.removeAllEventListeners(e);this.uiGet(e).addEventListener("click",(()=>this.sendStartVideoChatForm()))}this.initActiveOperatorFormCloser()}initActiveOperatorFormCloser(){const e=".qh_widget-closer--active-operator-form";if(this.uiExists(e)){r.HTMLUtils.removeAllEventListeners(e);this.uiGet(e).addEventListener("click",(()=>{this.collapseAndReinitActiveOperatorInitForm(!1)}))}}initRateUXCloser(){const e=".qh_widget-closer--rate-ux";if(this.uiExists(e)){r.HTMLUtils.removeAllEventListeners(e);this.uiGet(e).addEventListener("click",(()=>{this.collapseAndReinitActiveOperatorInitForm()}))}}initAwaitVideoCallCloser(){const e=".qh_widget-closer--await-video-call";if(this.uiExists(e)){r.HTMLUtils.removeAllEventListeners(e);this.uiGet(e).addEventListener("click",(()=>{this.cancelCall()}))}}initVideoCloser(){const e=".qh_widget-closer--video";if(this.uiExists(e)){r.HTMLUtils.removeAllEventListeners(e);this.uiGet(e).addEventListener("click",(()=>{this.onHangUpVideoChat()}))}}initInactiveOperatorCloser(){if(this.uiExists(".qh_widget-closer--inactive-operator")){r.HTMLUtils.removeAllEventListeners(".qh_widget-closer--inactive-operator");this.uiGet(".qh_widget-closer--inactive-operator").addEventListener("click",(()=>{this.collapseAndReinitInactiveOperatorInitForm()}))}}collapseAndReinitActiveOperatorInitForm(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.deactivateVideoMode(),this.service.getActiveOperatorInitForm().then((t=>{document.querySelector(".qh_video-ui_replace").innerHTML=t,this.activateActiveOperatorInitForm(),this.collapseView(),this.dispatchExtEvent("collapse"),e&&this.service.destroyVideoChatApp()}))}collapseAndReinitInactiveOperatorInitForm(){this.service.getInactiveOperatorInitForm().then((e=>{document.querySelector(".contact-form").innerHTML=e,this.initContactForm(),this.collapseView(),this.dispatchExtEvent("collapse")}))}sendScheduleForm(){const e={name:document.querySelector(".qh_module--inactive-form input[name=name]").value,email_address:document.querySelector(".qh_module--inactive-form input[name=email_address]").value,phone_number:document.querySelector("input[name=phone_number]").value,datetime:document.querySelector("input[name=datetime]").value};this.service.sendScheduleForm(e).then((e=>{document.querySelector(".contact-form").innerHTML=e,this.initContactForm(),this.collapseView()})).catch((e=>{console.log("reason",e)}))}sendStartVideoChatForm(){const e={name:document.querySelector(".qh_active-user-form__input[name=name]").value,email_address:document.querySelector(".qh_active-user-form__input[name=email_address]").value,phone_number:document.querySelector(".qh_active-user-form__input[name=phone_number]").value};this.service.sendStartVideoChatForm(e).then((e=>{document.querySelector(".qh_video-ui_replace").innerHTML=e;const t=this.uiGet(".qh_com-status"),s=t.dataset.status,i=t.dataset.userid;this.service.setUserId(i),"ok"===s?(this.requestCall(),this.initAwaitVideoCallCloser()):this.initStartVideoChatForm()})).catch((e=>{console.log("reason",e)}))}onAdmin(e){this.adminUser=e;const t=this.uiGet(".active-user__admin-name"),s=e.full_name.split(" ")[0];t.innerHTML=s}setThumbnails(e){this.uiArray(".active-user-form__thumbnail").forEach((t=>{t.style.backgroundImage=`url(${this.service.consoleAppUrl}/media/${e})`}))}toggleView(){this.isExpanded?(this.collapseView(),this.dispatchExtEvent("collapse")):this.expandView()}expandView(){this.isExpanded=!0,this.element.classList.add("js-expanded")}collapseView(){this.isExpanded=!1,this.element.classList.remove("js-expanded"),this.deactivateVideoMode()}updateVideoCallUi(){this.uiGet(".qh_module--active-operator").classList.toggle("js-enabled",this.anyOperatorActive);this.uiGet(".qh_module--inactive-form").classList.toggle("js-enabled",!this.anyOperatorActive),this.anyOperatorActive?this.videoMode||(this.activateActiveOperatorInitForm(),this.emit("collapse"),this.dispatchExtEvent("expand")):this.activateCallDefaultStage()}requestCall(){this.service.requestCall()}cancelCall(){this.service.cancelCall(),this.anyOperatorActive?this.videoMode||this.collapseAndReinitActiveOperatorInitForm(!1):this.activateCallDefaultStage()}onCallAccepted(e){this.uiGet("meta[name=room_id]").setAttribute("content",e),this.activateVideoChat()}deleteRoomId(){this.uiGet("meta[name=room_id]").setAttribute("content","")}onCallRejected(){this.activateCallRejectedStage()}activateCallRejectedStage(){const e=this.uiGet(".qh_video-ui_awating--line1");e.classList.add("qh_tight"),e.innerHTML="Sorry, all of our operators are busy, we will email you shortly!";this.uiGet(".qh_video-ui_awating--line2").remove()}activateCallDefaultStage(){this.deactivateAllStages();this.uiGet(".qh_module--inactive-form").classList.add("js-enabled"),this.deactivateVideoMode()}activateActiveOperatorInitForm(){this.deactivateAllStages();this.uiGet(".qh_submodule--init-form").classList.add("js-enabled"),this.initStartVideoChatForm()}activateRateUxForm(){this.deactivateAllStages();this.uiGet(".qh_submodule--rate-ux").classList.add("js-enabled"),this.initRateUXCloser()}activateVideoChat(){this.deactivateAllStages();this.uiGet(".qh_submodule--video-chat").classList.add("js-enabled"),this.activateVideoMode();this.uiGet(".confirm-join-button").addEventListener("click",(()=>{this.onJoinVideoChat()}));this.uiGet(".button--hangup").addEventListener("click",(()=>{this.onHangUpVideoChat()})),this.initVideoCloser()}onJoinVideoChat(){}onHangUpVideoChat(){this.activateRateUxForm(),this.activateVideoMode(),this.deleteRoomId()}deactivateAllStages(){this.uiArray(".qh_submodule").forEach((e=>{e.classList.remove("js-enabled")})),this.deactivateVideoMode()}activateVideoMode(){this.element.classList.add("qh_video-mode"),this.videoMode=!0}deactivateVideoMode(){this.element.classList.remove("qh_video-mode"),this.videoMode=!1}dispatchExtEvent(e){this.extDispatcher.dispatchEvent(new CustomEvent(e,{detail:{source:"widgetExtView"}}))}}},"./js/com/quickhellou/widget/WidgetService.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{WidgetService:()=>c});var i=s("./js/com/genb/base/service/EventEmitter.js"),r=s("./js/com/quickhellou/base/services/WebSocketService.js"),o=s("./js/com/quickhellou/base/services/ApiService.js"),n=s("./js/com/quickhellou/base/model/ApplicationSettings.js"),a=s("./js/com/quickhellou/base/utils/QhUtils.js");class c extends i.EventEmitter{constructor(e,t){super(),this.apiService=new o.ApiService(e),this.consoleAppUrl=e,this.widgetId=t,this.users=[]}async init(){return new Promise(((e,t)=>{this.apiService.getSettings().then((s=>{this.appSettings=new n.ApplicationSettings(s);try{this.apiService.getWidgetById(this.widgetId).then((s=>{this.widget=JSON.parse(s),this.install().then((s=>{const i=JSON.parse(s);"failure"===i.status&&t(i.result),this.webSocketService=new r.WebSocketService(this.appSettings.webSocketServiceUrl),this.webSocketService.addListener("register",(e=>{this.onUserRegister(e)})),this.webSocketService.addListener("listUsers",(e=>{this.onListUsers(e)})),this.webSocketService.addListener("callAccepted",(e=>{this.onCallAccepted(e)})),this.webSocketService.addListener("callRejected",(()=>{this.onCallRejected()})),this.webSocketService.addListener("error",(e=>{this.emit("error",e)})),this.webSocketService.addListener("communicationRecord",(e=>{this.onCommunicationRecord(e)})),this.user={uuid:"guest_"+String(Math.floor(Date.now()/1e3)),roomId:this.widget.uuid},this.webSocketService.registerGuest(this.user.uuid,this.widget.uuid);try{this.videochatProxy=videochat.proxy(),this.videochatProxy.addEventListener("close",(()=>{this.onCloseVideoChat()})),this.videochatProxy.addEventListener("remote_hangup",(()=>{this.onCloseVideoChat()}))}catch(e){}e()}))}))}catch(e){}}))}))}destroyVideoChatApp(){try{this.videochatProxy.destroy()}catch(e){console.log("e",e)}}onCloseVideoChat(){this.emit("videochatSessionClose")}requestCall(){const e=this.admins[0];this.webSocketService.requestCall(this.user.uuid,this.user.userId,e,this.widget.uuid)}cancelCall(){const e=this.admins[0];this.webSocketService.cancelCall(this.sessionRecord.id,this.user.userId,e,this.widget.uuid)}onUserRegister(e){"ok"===e&&this.webSocketService.listAdmins(this.user.uuid,this.widget.uuid)}onListUsers(e){if(this.admins=e,this.emit("listUsers",e),e.length){const t=a.QhUtils.extractUserId(e[0]);this.getUser(t).then((e=>{this.emit("admin",e)}))}}async onCallAccepted(e){this.emit("callAccepted",e)}onCallRejected(){this.emit("callRejected")}onCommunicationRecord(e){this.sessionRecord=e}sendScheduleForm(e){const t=`${this.consoleAppUrl}/dashboard/widget_schedule/${this.widgetId}/${encodeURIComponent(window.location.hostname.toLowerCase())}/${this.widget.uuid}`;return this.apiService.postAsXMLHttpRequest(e,t)}sendStartVideoChatForm(e){const t=`${this.consoleAppUrl}/dashboard/widget_active_operator/${this.widgetId}/${encodeURIComponent(window.location.hostname.toLowerCase())}/${this.widget.uuid}`;return this.apiService.postAsXMLHttpRequest(e,t)}async install(){const e=`${this.consoleAppUrl}/dashboard/install/${this.widgetId}/${encodeURIComponent(window.location.hostname.toLowerCase())}/${this.widget.uuid}`;return this.apiService.postAsXMLHttpRequest({},e)}async getUser(e){let t=await this.apiService.getUserById(e);return JSON.parse(t)}async rateComSession(e){let t=await this.apiService.rateComSession(this.sessionRecord.id,e);return JSON.parse(t)}setUserId(e){this.user.userId=e}async getActiveOperatorInitForm(){return await this.apiService.getAsXMLHttpRequest(`${this.consoleAppUrl}/dashboard/active_operator_init_form`)}async getInactiveOperatorInitForm(){return await this.apiService.getAsXMLHttpRequest(`${this.consoleAppUrl}/dashboard/inactive_operator_init_form`)}async getSchedulerCalendar(){const e=`${this.consoleAppUrl}/dashboard/widget_calendar_view/${this.widgetId}`;return await this.apiService.getAsXMLHttpRequest(e)}async getContactForm(e){const t=`${this.consoleAppUrl}/dashboard/add_widget_contact_form_view/${this.widgetId}`;return await this.apiService.postAsXMLHttpRequest(e,t)}async sendContactForm(e){const t=`${this.consoleAppUrl}/dashboard/edit_widget_contact_form_view/${this.widgetId}`;return await this.apiService.postAsXMLHttpRequest(e,t)}}},"../node_modules/js-cookie/src/js.cookie.js":(e,t,s)=>{var i,r;!function(o){if(void 0===(r="function"==typeof(i=o)?i.call(t,s,t,e):i)||(e.exports=r),!0,e.exports=o(),!!0){var n=window.Cookies,a=window.Cookies=o();a.noConflict=function(){return window.Cookies=n,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var s=arguments[e];for(var i in s)t[i]=s[i]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function s(i){function r(){}function o(t,s,o){if("undefined"!=typeof document){"number"==typeof(o=e({path:"/"},r.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var n=JSON.stringify(s);/^[\{\[]/.test(n)&&(s=n)}catch(e){}s=i.write?i.write(s,t):encodeURIComponent(String(s)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in o)o[c]&&(a+="; "+c,!0!==o[c]&&(a+="="+o[c].split(";")[0]));return document.cookie=t+"="+s+a}}function n(e,s){if("undefined"!=typeof document){for(var r={},o=document.cookie?document.cookie.split("; "):[],n=0;n<o.length;n++){var a=o[n].split("="),c=a.slice(1).join("=");s||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(a[0]);if(c=(i.read||i)(c,l)||t(c),s)try{c=JSON.parse(c)}catch(e){}if(r[l]=c,e===l)break}catch(e){}}return e?r[e]:r}}return r.set=o,r.get=function(e){return n(e,!1)},r.getJSON=function(e){return n(e,!0)},r.remove=function(t,s){o(t,"",e(s,{expires:-1}))},r.defaults={},r.withConverter=s,r}((function(){}))}))},"../node_modules/@babel/runtime/helpers/esm/defineProperty.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var i=s("../node_modules/@babel/runtime/helpers/esm/toPropertyKey.js");function r(e,t,s){return(t=(0,i.default)(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}},"../node_modules/@babel/runtime/helpers/esm/toPrimitive.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var i=s("../node_modules/@babel/runtime/helpers/esm/typeof.js");function r(e,t){if("object"!==(0,i.default)(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!==(0,i.default)(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}},"../node_modules/@babel/runtime/helpers/esm/toPropertyKey.js":(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var i=s("../node_modules/@babel/runtime/helpers/esm/typeof.js"),r=s("../node_modules/@babel/runtime/helpers/esm/toPrimitive.js");function o(e){var t=(0,r.default)(e,"string");return"symbol"===(0,i.default)(t)?t:String(t)}},"../node_modules/@babel/runtime/helpers/esm/typeof.js":(e,t,s)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}s.r(t),s.d(t,{default:()=>i})}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{"use strict";s.r(i);var e=s("./js/com/quickhellou/widget/WidgetService.js"),t=s("./js/com/quickhellou/widget/BadgeView.js"),r=s("./js/com/quickhellou/widget/ScheduleView.js"),o=s("./js/com/quickhellou/widget/WidgetExtensionView.js"),n=s("./js/com/quickhellou/widget/ContactInformationView.js");const a=document.querySelector(".qh-root").dataset.url,c=document.querySelector(".qh-root").dataset.id,l=new e.WidgetService(a,c);l.init().then((()=>{const e=new t.BadgeView(l),s=new o.WidgetExtensionView(l),i=new r.ScheduleView(l),a=new n.ContactInformationView(l),c=window.parent.document.QHDispatcher;c.addEventListener("collapse",(()=>{i.collapseView(),s.collapseView()}),!1),c.addEventListener("expand_contact",(e=>{s.expandView(),i.collapseView(),a.load(e.detail.datetime)}),!1),c.addEventListener("expand_schedule",(()=>{i.expandView(),s.collapseView()}),!1),c.addEventListener("setThumbnail",(e=>{s.setThumbnails(e)}),!1),e.init(),s.init(),i.init(),a.init(),document.querySelector(".qh-root").classList.add("active")})).catch((e=>{document.querySelector(".qh-root").style.opacity=1,document.querySelector(".qh-root").classList.add("failure"),document.querySelector(".qh-root").innerHTML=e}))})()})();
//# sourceMappingURL=widget.js.map