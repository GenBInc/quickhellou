!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=31)}([function(e,t,n){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var s=arguments[t],r=0,a=s.length;r<a;r++,o++)i[o]=s[r];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.Log=void 0;var o=n(1),s=function(){function e(){}return e.setEnvironment=function(e){this.isDevelopment=o.StringUtils.equals(e,"development")},e.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isDevelopment&&console.log.apply(console,i(["%c"+this.getNow(),"color: #008000",e],t))},e.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isDevelopment&&console.warn.apply(console,i(["%c"+this.getNow(),"color: #FF7F00",e],t))},e.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isDevelopment&&console.error.apply(console,i([""+this.getNow(),e],t))},e.assert=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];this.isDevelopment&&console.assert.apply(console,i([e,"%c"+this.getNow(),"color: #008000",t],n))},e.breakpoint=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isDevelopment&&console.log.apply(console,i(["%c"+this.getNow()+" "+e,"background-color: #144E8B; color:#fff"],t))},e.fatal=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isDevelopment&&console.log.apply(console,i(["%c"+this.getNow()+" "+e,"background-color: #c90000; color:#fff"],t))},e.success=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isDevelopment&&console.log.apply(console,i(["%c"+this.getNow()+" "+e,"background-color: #008000; color:#fff"],t))},e.info=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isDevelopment&&console.log.apply(console,i(["%c"+this.getNow()+" "+e,"background-color: #4AAEFB; color:#fff"],t))},e.getNow=function(){return(window.performance.now()/1e3).toFixed(3)},e.isDevelopment=!0,e}();t.Log=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StringUtils=void 0;var i=function(){function e(){}return e.isDefined=function(e){return"string"==typeof e},e.isEmpty=function(e){return"string"==typeof e&&0===e.length},e.isNotEmpty=function(e){return!this.isEmpty(e)},e.equals=function(e,t){return e===t},e.getUID=function(){return(new Date).getTime().toString()},e.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e.isEmailValid=function(e){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)},e.isUrlValid=function(e){return/((http|ftp|https):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/.test(e)},e.isNumber=function(e){return/^-?\d*[\.]?\d+$/.test(e)},e.isCurrency=function(e){return/(?=.)^\$?(([1-9][0-9]{0,2}(,[0-9]{3})*)|[0-9]+)?(\.[0-9]{1,2})?$/.test(e)},e.extractFormBuilderFormFieldType=function(e){return e.split(" ")[0].split("-")[1]},e.extractFileNameFromPath=function(e){return e.replace(/^.*[\\\/]/,"")},e.toBoolean=function(e){return/(true|True|1)/g.test(e)},e.toString=function(e){return e?"true":"false"},e.stripFromQuotes=function(t){var n=/(['"]?)(.*)\1/.exec(t);return n.length>2?n[2]:e.EMPTY},e.hashCode=function(e){return e.split("").reduce((function(e,t){return(e<<5)-e+t.charCodeAt(0)}),0)},e.EMPTY="",e.TRUE="true",e.FALSE="false",e.URL_TARGET_BLANK="_blank",e.URL_TARGET_SELF="_self",e}();t.StringUtils=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseUtils=void 0;var i=n(1),o=n(9),s=function(){function e(){}return e.isObjectDefined=function(e){try{return null!=e}catch(e){return!1}},e.isObjectNotEmpty=function(e){return this.isObjectDefined(e)&&0!==Object.getOwnPropertyNames(e).length},e.navigateToUrl=function(e){window.location.href=e},e.isLocalEnviroment=function(){return i.StringUtils.equals(this.getEnviroment(),o.Enviroment.LOCAL)},e.isSandboxEnviroment=function(){return i.StringUtils.equals(this.getEnviroment(),o.Enviroment.SANDBOX)},e.isProductionEnviroment=function(){return i.StringUtils.equals(this.getEnviroment(),o.Enviroment.PRODUCTION)},Object.defineProperty(e,"hostname",{get:function(){return window.location.hostname},enumerable:!1,configurable:!0}),e.getEnviroment=function(){var t=document.querySelector('meta[property="vis:env"]'),n=o.Enviroment.LOCAL;if(e.isObjectDefined(t))n=e.isObjectDefined(t)&&t.getAttribute("content");else{var s=window.location.hostname;n=i.StringUtils.equals(s,o.Enviroment.PRODUCTION_HOSTNAME)?o.Enviroment.PRODUCTION:o.Enviroment.SANDBOX}return n},e.UNDEFINED=void 0,e.NULL=null,e}();t.BaseUtils=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLUtils=void 0;var i=n(2),o=n(0),s=function(){function e(){}return e.get=function(e){var t=document.querySelector(e);return i.BaseUtils.isObjectDefined(t)||o.Log.warn('Element "'+e+'" is not defined.'),t},e.input=function(t){return e.get(t)},e.list=function(e){var t=document.querySelectorAll(e);return i.BaseUtils.isObjectDefined(t)||o.Log.warn('Elements "'+e+'" are not defined.'),t},e.array=function(t){return Array.from(e.list(t))},e.firstToHTMLElement=function(e){if(e.length>0)return e[0]},e.exists=function(e){var t=document.querySelector(e);return i.BaseUtils.isObjectDefined(t)},e.getCookie=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),i=0;i<n.length;i++){var o=n[i].trim();if(o.substring(0,e.length+1)===e+"="){t=decodeURIComponent(o.substring(e.length+1));break}}return t},e}();t.HTMLUtils=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcherService=void 0;var i=n(11),o=n(13),s=function(){function e(){this.listeners=new o.EventListeners}return e.prototype.addEventListener=function(e,t,n){var o=new i.EventListener(e,t,n);this.listeners.addEventListener(e,o)},e.prototype.removeEventListener=function(e){this.listeners.removeEventListener(e)},e.prototype.removeAllEventListeners=function(){this.listeners.empty()},e.prototype.dispatchEvent=function(e,t){this.listeners.getEventListenersListByType(e).forEach((function(e){e.getHandler().call(e.getScope(),t)}))},e}();t.EventDispatcherService=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Util=void 0;var i=n(1),o=n(0),s=function(){function e(){}return e.sendAsyncUrlRequest=function(e,t,n){return this.sendUrlRequest(e,t,!0,n)},e.sendUrlRequest=function(e,t,n,i){return new Promise((function(o,s){if(n){var r,a=function(){200===r.status?o(r.responseText):s(Error("Status="+r.status+", response="+r.responseText))};r=new XMLHttpRequest,n&&(r.onreadystatechange=function(){4===r.readyState&&a()}),r.open(e,t,n),r.send(i),n||a()}else o(navigator.sendBeacon(t,i))}))},e.parseJSON=function(e){try{return JSON.parse(e)}catch(t){o.Log.log("Error parsing json: "+e)}return null},e.setCookie=function(e,t,n,i){void 0===n&&(n=7),void 0===i&&(i="/");var o=new Date(Date.now()+864e5*n).toUTCString();document.cookie=e+"="+encodeURIComponent(t)+"; expires="+o+"; path="+i},e.getCookie=function(e){return document.cookie.split("; ").reduce((function(t,n){var i=n.split("=");return i[0]===e?decodeURIComponent(i[1]):t}),"")},e.deleteCookie=function(e,t){this.setCookie(e,"",-1,t)},e.isMobile=function(){return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))},e.isEdgeHTML=function(){return/Edge\//g.test(navigator.userAgent)},e.randomString=function(e){var t=[];e=e||5;for(;e--;)t.push("0123456789".charAt(Math.floor(Math.random()*"0123456789".length)));return t.join("")},e.queryStringToDictionary=function(e){var t=e.slice(1).split("&"),n={};return t.forEach((function(e){e&&(e=e.split("="))[0]&&(n[e[0]]=decodeURIComponent(e[1]||""))})),n},e.calculateFps=function(e,t,n,i,o){var s=0;if(e&&void 0!==typeof e.webkitDecodedFrameCount&&e.readyState>=e.HAVE_CURRENT_DATA){var r=(new Date).getTime(),a=(r-n)/1e3,c=r;s=(e.webkitDecodedFrameCount-t)/a,o(e.webkitDecodedFrameCount,c,i)}return parseInt(s)},e.requestIceServers=function(e,t){var n=this;return new Promise((function(s,r){n.sendAsyncUrlRequest("POST",e).then((function(e){var a=n.parseJSON(e);a?(i.StringUtils.isNotEmpty(t)&&n.filterIceServersUrls(a,t),o.Log.log("Retrieved ICE server information."),s(a.iceServers)):r(Error("Error parsing response JSON: "+e))})).catch((function(e){r(Error("ICE server request error: "+e.message))}))}))},e.isFullScreen=function(){return!(!document.isFullScreen&&!document.fullscreenEnabled)},e.setUpFullScreen=function(){document.cancelFullScreen=document.mozCancelFullScreen||document.cancelFullScreen,document.body.requestFullScreen=document.body.mozRequestFullScreen||document.body.requestFullScreen,document.onfullscreenchange=function(e){return document.onfullscreenchange}},e.requestFullscreen=function(){document.body.requestFullscreen?document.body.requestFullscreen():document.body.mozRequestFullScreen?document.body.mozRequestFullScreen():document.body.msRequestFullscreen&&document.body.msRequestFullscreen()},e.cancelFullScreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.cancelFullScreen&&document.cancelFullScreen()},e.filterIceServersUrls=function(e,t){for(var n="transport="+t,i=new Array,o=0;o<e.iceServers.length;++o){for(var s=e.iceServers[o],r=[],a=0;a<s.urls.length;++a){var c=s.urls[a];-1!==c.indexOf(n)?r.push(c):-1===c.indexOf("?transport=")&&r.push(c+"?"+n)}0!==r.length&&(s.urls=r,i.push(s))}e.iceServers=i},e}();t.Util=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.FormService=void 0;var s=n(4),r=n(2),a=n(0),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.post=function(e,n){return new Promise((function(i,o){var s=new XMLHttpRequest;s.open(t.POST,e,!0),s.addEventListener("load",(function(e){s.status===t.STATUS_FORBIDDEN?alert("You've been logged out. Please try again."):s.status===t.STATUS_INTERNAL_SERVER_ERROR?(a.Log.warn("There was an error while processing your request.",s.statusText,s.responseText),o(s.responseText)):s.statusText===t.OK&&r.BaseUtils.isObjectDefined(i)&&i(s.responseText)})),n?s.send(n):s.send()}))},t.prototype.get=function(e,n){var i=new XMLHttpRequest;i.open(t.GET,e),i.addEventListener("load",(function(e){i.status===t.STATUS_FORBIDDEN?alert("You've been logged out. Please try again."):i.status===t.STATUS_INTERNAL_SERVER_ERROR?alert("There was an error while processing your request."):i.status===t.STATUS_OK&&r.BaseUtils.isObjectDefined(n)&&n(i.responseText)})),i.send()},t.LOAD="load",t.OK="OK",t.STATUS_OK=200,t.STATUS_FORBIDDEN=403,t.STATUS_INTERNAL_SERVER_ERROR=500,t.GET="GET",t.POST="POST",t}(s.EventDispatcherService);t.FormService=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSelectionEvent=void 0;var i=function(){function e(){}return e.ROOM_SELECTED="room_selected",e.SCHEDULER_SELECTED="scheduler_selected",e}();t.RoomSelectionEvent=i},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Enviroment=void 0;var i=function(){function e(){}return e.LOCAL="local",e.SANDBOX="sandbox",e.PRODUCTION="production",e.LOCAL_HOSTNAME="Computer",e.SANDBOX_HOSTNAME="elara.genesi.pl",e.PRODUCTION_HOSTNAME="deposit.venturevisa.com",e}();t.Enviroment=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallEvent=void 0;var i=function(){function e(){}return e.ERROR="error",e.STATUS_MESSAGE="status_message",e.NEW_ICE_CANDIDATE="new_ice_candidate",e.ICE_CONNECTION_STATE_CHANGE="ice_connection_state_change",e.SIGNALING_STATE_CHANGE="signaling_state_change",e.REMOTE_STREAM_ADDED="remote_stream_added",e.LOCAL_STREAM_ADDED="local_stream_added",e.LOCAL_DISPLAY_MEDIA_TRACK_ADDED="local_display_media_track_added",e.REMOTE_SDP_PROTOCOL_RECEIVED="remote_sdp_protocol_received",e.REMOTE_HANGUP="remote_hangup",e.WEBSOCKET_CLOSED="websocket_closed",e.WSS_RESPONSE="wss_response",e.CALLER_STARTED="caller_started",e.REMOTE_TEXT_CHAT_MESSAGE="remote_text_chat_message",e.REMOTE_CLIENT_REGISTERED="remote_client_registered",e.LOCAL_VIDEO_MEDIA_CHANGE="local_video_media_change",e}();t.CallEvent=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventListener=void 0;var i=n(12),o=function(){function e(e,t,n){this.event=new i.EventObject(e),this.handler=t,this.scope=n}return e.prototype.getHandler=function(){return this.handler},e.prototype.getEventObject=function(){return this.event},e.prototype.getScope=function(){return this.scope},e}();t.EventListener=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventObject=void 0;var i=n(1),o=function(){function e(e,t){this.type=e,i.StringUtils.isDefined(t)&&this.setData(t)}return e.prototype.getType=function(){return this.type},e.prototype.setType=function(e){this.type=e},e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e},e.COMPLETE="complete",e}();t.EventObject=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventListeners=void 0;var i=function(){function e(){this.setListeners(new Array)}return e.prototype.addEventListener=function(e,t){var n=this.getEventListenersListByType(e);n.push(t),this.listeners[e]=n},e.prototype.removeEventListener=function(e){delete this.listeners[e]},e.prototype.getEventListenersListByType=function(e){var t=this.listeners[e];return t||[]},e.prototype.empty=function(){this.listeners=[]},e.prototype.getListeners=function(){return this.listeners},e.prototype.setListeners=function(e){this.listeners=e},e}();t.EventListeners=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PeerConnectionResponseType=void 0;var i=n(1),o=n(5),s=function(){function e(){}return e.isType=function(e,t){return i.StringUtils.equals(e,t)},e.isResponse=function(e){return this.isType(this.RESPONSE,e)},e.isAnswer=function(e){return this.isType(this.ANSWER,e)},e.isOffer=function(e){return this.isType(this.OFFER,e)},e.isCandidate=function(e){return this.isType(this.CANDIDATE,e)},e.isBye=function(e){return this.isType(this.BYE,e)},e.isTextChatMessage=function(e){if(this.isType(this.BROADCAST,e.type)){var t=o.Util.parseJSON(e.body);return this.isType(this.TEXT_CHAT_MESSAGE,t.type)}return!1},e.isRemoteIceComplete=function(e){return this.isType(this.REMOTE_ICE_COMPLETE,e)},e.isPing=function(e){return this.isType(this.PING,e)},e.isUnreachableClient=function(e){return this.isType(this.UNREACHABLE_CLIENT,e)},e.RESPONSE="response",e.ANSWER="answer",e.OFFER="offer",e.CANDIDATE="candidate",e.BROADCAST="broadcast",e.TEXT_CHAT_MESSAGE="text-chat-message",e.BYE="bye",e.PING="ping",e.UNREACHABLE_CLIENT="unreachable_client",e.REMOTE_ICE_COMPLETE="remote_ice_complete",e}();t.PeerConnectionResponseType=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShareScreenEvent=void 0;var i=function(){function e(){}return e.START_SHARING="start_sharing",e.STOP_SHARING="stop_sharing",e.NOT_ALLOWED="not_allowed",e}();t.ShareScreenEvent=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSelection=void 0;var s=n(3),r=n(4),a=n(7),c=n(5),l=function(e){function t(t){var n=e.call(this)||this;return n.roomType=t,n.roomID=c.Util.randomString(9),n.attachButtonEvents(),n}return o(t,e),t.prototype.attachButtonEvents=function(){this.attachJoinButtonsEvents(),this.attachSchedulerButtonsEvents()},t.prototype.attachJoinButtonsEvents=function(){var e=this;s.HTMLUtils.array(".button--quick-talk").forEach((function(t){t.addEventListener("click",(function(){e.onJoinButton()}),!1)}))},t.prototype.attachSchedulerButtonsEvents=function(){var e=this;s.HTMLUtils.array(".button--scheduler").forEach((function(t){t.addEventListener("click",(function(){e.onSchedulerButton()}),!1)}))},t.matchRandomRoomPattern=function(e){return null!==e.match(/^\d{9}$/)},t.prototype.removeEventListeners=function(){},t.prototype.onJoinButton=function(){this.dispatchEvent(a.RoomSelectionEvent.ROOM_SELECTED,{roomID:this.roomID})},t.prototype.onSchedulerButton=function(){this.dispatchEvent(a.RoomSelectionEvent.SCHEDULER_SELECTED,{roomID:this.roomID})},t}(r.EventDispatcherService);t.RoomSelection=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AppControllerEvent=void 0;var i=function(){function e(){}return e.INITIALIZED="initialized",e}();t.AppControllerEvent=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLComponent=void 0;var s=n(2),r=n(37),a=n(0),c=function(e){function t(t){var n=e.call(this)||this;return n.setElement(t),n}return o(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.element.remove()},t.prototype.setElement=function(e){this.element=e},t.prototype.getElement=function(){try{return this.element}catch(e){a.Log.error("No element for ",this.getId()," component")}},t.prototype.getData=function(e){return s.BaseUtils.isObjectDefined(this.getElement())?this.getElement().dataset[e]:s.BaseUtils.UNDEFINED},t.prototype.findElements=function(e){return s.BaseUtils.isObjectDefined(this.getElement())?this.getElement().querySelectorAll(e):s.BaseUtils.UNDEFINED},t.prototype.findElement=function(e){if(s.BaseUtils.isObjectDefined(this.getElement())){var t=this.findElements(e);if(t.length>0)return t[0]}return s.BaseUtils.UNDEFINED},t.prototype.findFormElement=function(){return this.findElement("form")},t.prototype.findInputElement=function(){return this.findElement("input")},t.prototype.addClass=function(e){s.BaseUtils.isObjectDefined(this.getElement())&&this.getElement().classList.add(e)},t.prototype.removeClass=function(e){s.BaseUtils.isObjectDefined(this.getElement())&&this.getElement().classList.remove(e)},t.prototype.addHTMLEventListener=function(e,t){var n=this;this.getElement().addEventListener(e,(function(){t.call(n)}))},t.prototype.enable=function(){e.prototype.enable.call(this),this.getElement().classList.remove("js-disabled")},t.prototype.disable=function(){e.prototype.disable.call(this),this.getElement().classList.add("js-disabled")},t.prototype.setIsEnabled=function(t){e.prototype.setIsEnabled.call(this,t),this.getElement().classList.toggle("js-disabled",!t)},t}(r.ToggleableComponent);t.HTMLComponent=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteVideosEvent=void 0;var i=function(){function e(){}return e.REMOTE_VIDEO_ADDED="remote_video_added",e.REMOTE_VIDEO_REMOVED="remote_video_removed",e.ADD_STREAM_SUCCESS="add_stream_success",e.ADD_STREAM_FAILURE="add_stream_failure",e}();t.RemoteVideosEvent=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Room=void 0;var i=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.id=e,this.link=t};t.Room=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&s[0]?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ColliderService=void 0;var a=n(5),c=n(22),l=n(6),d=n(0),u=n(2),h=n(1),p=function(e){function t(t,n){var i=e.call(this)||this;return i.isSet=!1,i.registered=!1,i.ROOM_TYPE="room",u.BaseUtils.isObjectDefined(t)&&(i.wssUrl=t),u.BaseUtils.isObjectDefined(n)&&(i.wssPostUrl=n),i}return o(t,e),t.setupInstance=function(e,n){return t.instance||(t.instance=new t(e,n),this.instance.isSet=!0),t.instance},t.getInstance=function(){return t.instance||(t.instance=new t),u.BaseUtils.isObjectDefined(this.instance.isSet)?t.instance:(d.Log.warn("ColliderService::getInstance Collider service is not set."),null)},t.prototype.open=function(){var e=this;if(!u.BaseUtils.isObjectDefined(this.websocket))return d.Log.log("Opening signaling channel: "+this.wssUrl),new Promise((function(t,n){e.websocket=new WebSocket(e.wssUrl),e.websocket.onopen=function(){d.Log.log("Signaling channel opened."),e.websocket.onerror=function(e){n("Signaling channel error. "+e)},e.websocket.onclose=function(t){d.Log.log("Collider channel closed with code:"+t.code),e.websocket=null,e.registered=!1,e.dispatchEvent(c.ColliderServiceEvent.CLOSE,t.code)},u.BaseUtils.isObjectDefined(e.clientID)&&u.BaseUtils.isObjectDefined(e.roomId)&&e.register(e.roomId,e.clientID),t()},e.websocket.onmessage=function(t){d.Log.log("Collider -> Client: ",JSON.parse(t.data));var n=a.Util.parseJSON(t.data);u.BaseUtils.isObjectDefined(n)?h.StringUtils.isEmpty(n.error)?e.dispatchEvent(c.ColliderServiceEvent.MESSAGE,n.msg):d.Log.log("Signaling server error message: "+n.error):d.Log.log("Failed to parse WSS message: "+t.data)},e.websocket.onerror=function(e){n(Error("WebSocket error. "+e))}}));d.Log.log("ERROR: ColliderService has been already opened.")},t.prototype.respondOnPingRequest=function(){var e={cmd:"ping",roomid:this.roomId,roomtype:this.ROOM_TYPE,clientid:this.clientID};this.postMessage(e)},t.prototype.updateSession=function(e){var t={cmd:"session-update",roomid:this.roomId,roomtype:this.ROOM_TYPE,msg:e};this.postMessage(t)},t.prototype.register=function(e,t){var n=this;return new Promise((function(i,o){if(n.roomId=e,n.clientID=t,!u.BaseUtils.isObjectDefined(n.roomId))return d.Log.log("ERROR: Missing roomID. Stopping client registration."),o({code:0,message:"Missing roomID."});if(!u.BaseUtils.isObjectDefined(n.clientID))return d.Log.log("ERROR: Missing clientID. Stopping client registration."),o({code:0,message:"Missing clientID."});if(!n.websocket||n.websocket.readyState!==WebSocket.OPEN)return o({code:0,message:"WebSocket not open."});var s={cmd:"register",roomid:n.roomId,roomtype:n.ROOM_TYPE,clientid:n.clientID};return n.websocket.send(JSON.stringify(s)),n.registered=!0,i({code:1,message:"Signaling channel registered."})}))},t.prototype.touch=function(e,t){var n=this;return new Promise((function(i,o){if(n.roomId=e,n.clientID=t,!u.BaseUtils.isObjectDefined(n.roomId))return d.Log.log("ERROR: Missing roomID. Stopping client registration."),o({code:0,message:"Missing roomID."});if(!u.BaseUtils.isObjectDefined(n.clientID))return d.Log.log("ERROR: Missing clientID. Stopping client registration."),o({code:0,message:"Missing clientID."});if(!n.websocket||n.websocket.readyState!==WebSocket.OPEN)return o({code:0,message:"WebSocket not open."});var s={cmd:"touch",roomid:n.roomId,roomtype:n.ROOM_TYPE,clientid:n.clientID};return n.websocket.send(JSON.stringify(s)),i({code:1,message:"Touch sent."})}))},t.prototype.close=function(e){return s(this,void 0,void 0,(function(){var t,n;return r(this,(function(i){switch(i.label){case 0:if(d.Log.log("Closing websocket."),this.websocket&&(this.websocket.close(),this.websocket=null),!this.clientID||!this.roomId)return[2];t=this.getWssPostUrl(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,a.Util.sendUrlRequest("POST",t,e,"DELETE")];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),d.Log.log("Error deleting web socket connection: "+n.message),[3,4];case 4:return this.clientID=null,this.roomId=null,this.registered=!1,[2]}}))}))},t.prototype.send=function(e,t){if(void 0===t&&(t=!0),this.roomId&&this.clientID){var n={cmd:"send",msg:e,persistant:t.toString()};this.postMessage(n)}else d.Log.log("ERROR: ColliderService has not registered.")},t.prototype.sendToOther=function(e,t,n,i){if(this.roomId&&this.clientID){var o={cmd:"send-to-other",roomid:e,clientid:t,otherid:n,msg:i};this.postMessage(o)}else d.Log.log("ERROR: ColliderService has not registered.")},t.prototype.broadcast=function(e,t){var n={cmd:"broadcast",msg:JSON.stringify({type:e,roomid:this.roomId,clientid:this.clientID,data:t})};this.postMessage(n)},t.prototype.getWssPostUrl=function(){return this.wssPostUrl+"/"+this.roomId+"/"+this.clientID},t.prototype.postMessage=function(e){var t=JSON.stringify(e);this.websocket&&this.websocket.readyState===WebSocket.OPEN?this.websocket.send(t):this.post(this.getWssPostUrl(),e.msg)},t.MESSAGE="message",t}(l.FormService);t.ColliderService=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColliderServiceEvent=void 0;var i=function(){function e(){}return e.CLOSE="close",e.MESSAGE="message",e}();t.ColliderServiceEvent=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PeerConnectionClientEvent=void 0;var i=function(){function e(){}return e.REMOTE_SDP_PROTOCOL_RECEIVED="remote_sdp_protocol_received",e.PY_MESSAGE="gae_message",e.SIGNALING_MESSAGE="signaling_message",e.REMOTE_HANGUP="remote_hangup",e.REMOTE_TEXT_CHAT_MESSAGE="remote_text_chat_message",e.SIGNALING_STATE_CHANGE="signaling_state_change",e.ICE_GATHERING_COMPLETE="ice_gathering_complete",e.NEW_ICE_CANDIDATE="new_ice_candidate",e.ICE_CONNECTION_STATE_CHANGE="ice_connection_state_change",e.REMOTE_STREAM_ADDED="remote_stream_added",e.REGISTERED="registered",e.CREATE_OFFER_SUCCESS="create_offer_success",e.CREATE_ANSWER_SUCCESS="create_answer_success",e.REMOTE_CLIENT_REGISTERED="remote_client_registered",e.ERROR="error",e}();t.PeerConnectionClientEvent=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BandwidthLevelUpdateEvent=void 0;var i=function(){function e(){}return e.INBOUND_LEVEL_CHANGE="inbound_level_change",e.OUTBOUND_LEVEL_CHANGE="outbound_level_change",e}();t.BandwidthLevelUpdateEvent=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BandwidthLevel=void 0;var i=function(){function e(){}return e.isLow=function(t){return t>0&&t<e.LOW_BITRATE},e.isMedium=function(t){return t>e.LOW_BITRATE&&t<e.HIGH_BITRATE},e.isHigh=function(t){return t>=e.HIGH_BITRATE},e.getBitrate=function(t){return t===e.LOW?"30":t===e.MEDIUM?"150":t===e.HIGH?"unlimited":void 0},e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.LOW_BITRATE=50,e.HIGH_BITRATE=150,e}();t.BandwidthLevel=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionInit=void 0;var i=function(){function e(){this.sessions=[]}return e.prototype.addSession=function(e){this.sessions.push(e)},e}();t.SessionInit=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RtcSession=void 0;var i=function(e,t,n,i,o){void 0===i&&(i=!1),void 0===o&&(o=!1),this.id=e,this.messages=t,this.otherClientId=n,this.isInitiator=i,this.isForward=o};t.RtcSession=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoTrackEventOptions=void 0;var i=function(){function e(t,n){void 0===n&&(n=e.CAMERA),this.track=t,this.type=n}return e.CAMERA="camera",e.SCREEN_CAPTURE="screen_capture",e}();t.VideoTrackEventOptions=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryJobEvent=void 0;var i=function(){function e(){}return e.COMPLETE="complete",e}();t.RetryJobEvent=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEvent=void 0;var i=function(){function e(){}return e.DISPLAY_MEDIA_DISPLAYED="display_media_displayed",e.DISPLAY_MEDIA_CLOSED="display_media_closed",e}();t.MediaEvent=i},function(e,t,n){e.exports=n(32)},function(e,t,n){"use strict";var i=this;Object.defineProperty(t,"__esModule",{value:!0}),n(8);var o=n(2),s=n(3),r=n(0),a=n(33),c=n(17),l=n(56);r.Log.setEnvironment("production"),r.Log.log("Quick Hellou v. 0.9.0 production build (webrtc-adapter v. 8.1.0)");var d=new l.LoadingParams;try{o.BaseUtils.isObjectDefined(inlineLoadingParams)&&(d.bypassJoinConfirmation=inlineLoadingParams.bypassJoinConfirmation,d.iceServerRequestUrl=inlineLoadingParams.iceServerRequestUrl,d.errorMessages=inlineLoadingParams.errorMessages,d.warningMessages=inlineLoadingParams.warningMessages,d.mediaConstraints=inlineLoadingParams.mediaConstraints,d.offerOptions=inlineLoadingParams.offerOptions,d.peerConnectionConfig=inlineLoadingParams.peerConnectionConfig,d.peerConnectionConstraints=inlineLoadingParams.peerConnectionConstraints,d.roomType=inlineLoadingParams.roomType,d.wssPostUrl=inlineLoadingParams.wssPostUrl,d.wssUrl=inlineLoadingParams.wssUrl,o.BaseUtils.isObjectDefined(inlineLoadingParams.roomID)&&(d.roomID=inlineLoadingParams.roomID),o.BaseUtils.isObjectDefined(inlineLoadingParams.roomLink)&&(d.roomLink=inlineLoadingParams.roomLink),o.BaseUtils.isObjectDefined(inlineLoadingParams.additionalParam)&&(d.additionalParam=inlineLoadingParams.additionalParam)),window.addEventListener("load",(function(){var e=new a.AppController(d);e.addEventListener(c.AppControllerEvent.INITIALIZED,(function(){s.HTMLUtils.get("main").classList.add("js-visible"),setTimeout((function(){s.HTMLUtils.get("div.loader").remove()}),1e3)}),i),e.init()}))}catch(e){r.Log.warn(e)}},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var s=arguments[t],r=0,a=s.length;r<a;r++,o++)i[o]=s[r];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.AppController=void 0;var r=n(2),a=n(3),c=n(17),l=n(10),d=n(5),u=n(34),h=n(35),p=n(1),v=n(4),f=n(36),g=n(39),m=n(20),E=n(19),S=n(41),y=n(30),C=n(0),L=n(52),_=n(15),R=n(28),T=n(16),b=n(53),w=function(e){function t(t){var n=e.call(this)||this;return n.hide=function(e){e.classList.add("hidden")},n.show=function(e){e.classList.remove("hidden")},n.deactivate=function(e){e.classList.remove("active")},n.loadingParams=t,n.loadUrlParams(),n.createCommunication(),n}return o(t,e),t.prototype.init=function(){var e=this;C.Log.log("Initializing; Room ID "+(r.BaseUtils.isObjectDefined(this.loadingParams.roomID)?"= "+this.loadingParams.roomID:"not defined")+"."),this.hangupSvg=a.HTMLUtils.get(b.UIConstants.hangupSvg),this.icons=a.HTMLUtils.get(b.UIConstants.icons),this.localVideo=a.HTMLUtils.get(b.UIConstants.localVideo),this.miniVideo=a.HTMLUtils.get(b.UIConstants.miniVideo),this.sharingDiv=a.HTMLUtils.get(b.UIConstants.sharingDiv),this.initRemoteVideos(),this.videosDiv=a.HTMLUtils.get(b.UIConstants.videosDiv),this.roomLinkHref=a.HTMLUtils.get(b.UIConstants.roomLinkHref),this.roomLinkHrefWaiting=a.HTMLUtils.get(b.UIConstants.roomLinkHrefWaiting),this.rejoinDiv=a.HTMLUtils.get(b.UIConstants.rejoinDiv),this.textChatButton=a.HTMLUtils.get(b.UIConstants.textChatButton),this.rejoinButton=a.HTMLUtils.get(b.UIConstants.rejoinButton),this.newRoomButton=a.HTMLUtils.get(b.UIConstants.newRoomButton),this.fullscreenIcon=a.HTMLUtils.get(b.UIConstants.fullscreenSvg),this.hellouLogoFooterDiv=a.HTMLUtils.get(b.UIConstants.hellouLogoFooterDiv),this.overlayDiv=a.HTMLUtils.get(b.UIConstants.overlayDiv),this.overlayWaitingDiv=a.HTMLUtils.get(b.UIConstants.overlayWaitingDiv),this.closeOverlayButton=a.HTMLUtils.get(b.UIConstants.closeOverlayButton),this.textChatWindow=a.HTMLUtils.get(b.UIConstants.textChat.chatWindow),this.textChatCloseButton=a.HTMLUtils.get(b.UIConstants.textChat.closeButton),this.textChatCollapseButton=a.HTMLUtils.get(b.UIConstants.textChat.collapseButton),this.textChatMessageList=a.HTMLUtils.get(b.UIConstants.textChat.messageList),this.textChatInput=a.HTMLUtils.get(b.UIConstants.textChat.input),this.newRoomButton.addEventListener("click",(function(){e.onNewRoomClick()}),!1),this.rejoinButton.addEventListener("click",(function(){e.onRejoinClick()}),!1),this.closeOverlayButton.addEventListener("click",(function(){e.onCloseOverlayClick()}),!1),this.textChatButton.addEventListener("click",(function(){e.onTextChatButtonClick()}),!1),this.textChatCloseButton.addEventListener("click",(function(){e.onTextChatCloseButtonClick()}),!1),this.textChatCollapseButton.addEventListener("click",(function(t){e.onTextChatCollapseButtonClick()}),!1),this.textChatInput.addEventListener("keyup",(function(t){e.onTextChatInputKeyUp(t)}),!1),a.HTMLUtils.get(".text-chat-window__send-message-button").addEventListener("click",(function(){e.sendTextChatMessageButtonClickHandler()}));var t=a.HTMLUtils.array(".button--send-invitation");a.HTMLUtils.array(".overlay__closer-button").forEach((function(t){t.addEventListener("click",(function(n){e.closeOverlay(a.HTMLUtils.get("."+t.dataset.screen),a.HTMLUtils.array(".button--overlay[data-screen='"+t.dataset.screen+"']"))}))})),t.forEach((function(t){var n=t.dataset.screen,i="."+n,o=a.HTMLUtils.array(".button--overlay[data-screen='"+n+"']");t.onclick=function(){e.closeAllOverlays(),a.HTMLUtils.get(i).classList.remove("hidden"),a.HTMLUtils.get(".overlay--"+n+"__result").classList.add("hidden"),a.HTMLUtils.get(".overlay--"+n+"__result-message").innerHTML="",a.HTMLUtils.get(".overlay--"+n+"__body").classList.remove("hidden"),o.forEach((function(e){e.classList.add("js-active")}))}})),a.HTMLUtils.get(".button--setup-future-talk").addEventListener("click",(function(e){var t=a.HTMLUtils.get(".overlay--setup-future-talk");r.BaseUtils.isObjectDefined(t)&&t.classList.remove("hidden")})),this.shareScreenButton=new L.ScreenShareButtonComponent(a.HTMLUtils.get(".button--share-screen")),d.Util.isMobile()||d.Util.isEdgeHTML()?this.shareScreenButton.disableSharingState():(this.shareScreenButton.init(),this.shareScreenButton.addEventListener(_.ShareScreenEvent.START_SHARING,(function(){e.mediaCommunication.displayMedia()}),this),this.shareScreenButton.addEventListener(_.ShareScreenEvent.STOP_SHARING,(function(){e.mediaCommunication.stopSendingDisplayMedia()}),this)),new f.InvitationView(a.HTMLUtils.get(".send-invitation"));var n=a.HTMLUtils.get(".text-chat-window__message-input");if(n.addEventListener("focusin",(function(e){"Type your message here"===n.value&&(n.value="")})),n.addEventListener("focusout",(function(){p.StringUtils.isEmpty(n.value)&&(n.value="Type your message here")})),this.muteAudioIconSet=new u.IconSet(b.UIConstants.muteAudioSvg),this.muteVideoIconSet=new u.IconSet(b.UIConstants.muteVideoSvg),this.fullscreenIconSet=new u.IconSet(b.UIConstants.fullscreenSvg),this.roomLink=p.StringUtils.EMPTY,this.localStream=null,this.createCall(),this.loadingParams.roomID)if(this.updateInvitationLinks(this.loadingParams.roomID),p.StringUtils.equals(this.loadingParams.additionalParam,"setup"))this.roomSelectedHander(this.loadingParams.roomID);else{if(!T.RoomSelection.matchRandomRoomPattern(this.loadingParams.roomID))a.HTMLUtils.get(b.UIConstants.confirmJoinRoomSpan).textContent=' "'+this.loadingParams.roomID+'"';var i=a.HTMLUtils.get(b.UIConstants.confirmJoinDiv);this.show(i),a.HTMLUtils.get(b.UIConstants.confirmJoinButton).addEventListener("click",(function(){e.hide(i),e.setupCall()})),this.loadingParams.bypassJoinConfirmation&&(this.hide(i),this.setupCall())}else C.Log.warn("Missing RoomID.");window.addEventListener("online",(function(t){e.updateOnlineStatus(t)})),window.addEventListener("offline",(function(t){e.updateOnlineStatus(t)})),p.StringUtils.isNotEmpty(this.loadingParams.additionalParam)&&p.StringUtils.equals(this.loadingParams.additionalParam,"invite")&&this.openSendInvitationOverlay(),this.dispatchEvent(c.AppControllerEvent.INITIALIZED)},t.prototype.createCommunication=function(){this.mediaCommunication=new S.MediaCommunication(this.loadingParams)},t.prototype.openSendInvitationOverlay=function(){var e=this;a.HTMLUtils.array(".button--overlay").forEach((function(){var t="send-invitation",n=a.HTMLUtils.array(".button--overlay[data-screen='"+t+"']");e.closeAllOverlays(),a.HTMLUtils.get(".send-invitation").classList.remove("hidden"),a.HTMLUtils.get(".overlay--"+t+"__result").classList.add("hidden"),a.HTMLUtils.get(".overlay--"+t+"__result-message").innerHTML="",a.HTMLUtils.get(".overlay--"+t+"__body").classList.remove("hidden"),n.forEach((function(e){e.classList.add("js-active")}))}))},t.prototype.closeAllOverlays=function(){this.closeOverlay(a.HTMLUtils.get(".send-invitation"),a.HTMLUtils.array(".button--overlay[data-screen='send-invitation']"))},t.prototype.closeOverlay=function(e,t){e.classList.add("hidden"),t.forEach((function(e){e.classList.remove("js-active")}))},t.prototype.updateOnlineStatus=function(e){navigator.onLine},t.prototype.roomSelectedHander=function(e){var t=a.HTMLUtils.get(b.UIConstants.roomSelection.div),n=window.location.protocol+"//"+window.location.host+"/r/"+e;this.mediaCommunication.setRoom(e,n),this.pushCallNavigation(new m.Room(e,n)),this.localStream&&this.attachLocalStream(),this.hide(t),this.createCall(),this.setupCall(),a.HTMLUtils.get("footer .button--setup-future-talk").href="/scheduler/"+e},t.prototype.loadUrlParams=function(){var e=d.Util.queryStringToDictionary(window.location.search);this.loadingParams.audioSendBitrate=e.asbr,this.loadingParams.audioSendCodec=e.asc,this.loadingParams.audioRecvBitrate=e.arbr,this.loadingParams.audioRecvCodec=e.arc,this.loadingParams.opusMaxPbr=e.opusmaxpbr,this.loadingParams.opusFec=e.opusfec,this.loadingParams.opusDtx=e.opusdtx,this.loadingParams.opusStereo=e.stereo,this.loadingParams.videoSendBitrate=e.vsbr,this.loadingParams.videoSendInitialBitrate=e.vsibr,this.loadingParams.videoSendCodec=e.vsc,this.loadingParams.videoRecvBitrate=e.vrbr,this.loadingParams.videoRecvCodec=e.vrc||"VP9",this.loadingParams.videoFec=e.videofec},t.prototype.createCall=function(){var e=this;this.mediaCommunication.addEventListener(l.CallEvent.WEBSOCKET_CLOSED,this.hangup,this),this.mediaCommunication.addEventListener(l.CallEvent.REMOTE_HANGUP,(function(t){e.onRemoteHangup(t)}),this),this.mediaCommunication.addEventListener(l.CallEvent.REMOTE_SDP_PROTOCOL_RECEIVED,(function(t){e.onRemoteSdpProtocolReceived(t.sessionId,t.isRemoteVideoPlaybackAvailable,t.isRemoteDisplayMediaAvailable)}),this),this.mediaCommunication.addEventListener(l.CallEvent.REMOTE_STREAM_ADDED,(function(t){e.onRemoteStreamAdded(t.sessionId,t.stream)}),this),this.mediaCommunication.addEventListener(l.CallEvent.LOCAL_STREAM_ADDED,(function(t){e.onLocalStreamAdded(t)}),this),this.mediaCommunication.addEventListener(l.CallEvent.SIGNALING_STATE_CHANGE,(function(){}),this),this.mediaCommunication.addEventListener(l.CallEvent.ICE_CONNECTION_STATE_CHANGE,(function(){}),this),this.mediaCommunication.addEventListener(l.CallEvent.NEW_ICE_CANDIDATE,(function(e){}),this),this.mediaCommunication.addEventListener(y.MediaEvent.DISPLAY_MEDIA_DISPLAYED,(function(){e.shareScreenButton.unlock()}),this),this.mediaCommunication.addEventListener(l.CallEvent.REMOTE_TEXT_CHAT_MESSAGE,(function(t){e.onRemoteTextChatMessage(t)}),this),this.mediaCommunication.addEventListener(l.CallEvent.STATUS_MESSAGE,(function(e){C.Log.log(e)}),this),this.mediaCommunication.addEventListener(l.CallEvent.ERROR,(function(t){e.displayError(t)}),this),this.mediaCommunication.addEventListener(l.CallEvent.CALLER_STARTED,this.displaySharingInfo,this),this.mediaCommunication.addEventListener(l.CallEvent.REMOTE_CLIENT_REGISTERED,(function(t){e.onRemoteClientRegistered(t)}),this),this.mediaCommunication.addEventListener(l.CallEvent.LOCAL_VIDEO_MEDIA_CHANGE,(function(t){e.toggleVideoTrack(t)}),this),this.mediaCommunication.addEventListener(_.ShareScreenEvent.NOT_ALLOWED,(function(){e.shareScreenButton.enableSharingState()}),this),this.mediaCommunication.createCall(),this.show(this.hellouLogoFooterDiv),this.show(this.videosDiv),this.show(this.overlayDiv)},t.prototype.toggleVideoTrack=function(e){var t=e.track;this.localStream.getTracks().forEach((function(e){e.enabled=e.id===t.id}));var n=p.StringUtils.equals(e.type,R.VideoTrackEventOptions.SCREEN_CAPTURE);this.shareScreenButton.toggleScreenSharingWithFlag(n);var i=s(this.localStream.getAudioTracks(),[t]),o=new MediaStream(i);try{this.miniVideo.srcObject=o}catch(e){C.Log.warn("Unable to attach stream to video element.")}this.toggleAudioUnMute()},t.prototype.setupCall=function(){var e=this;this.mediaCommunication.connect(),this.setupUI(),window.onbeforeunload=function(){e.mediaCommunication.hangupCall(!1)},window.onpopstate=function(e){e.state?e.state.roomLink&&(location.href=e.state.roomLink):(C.Log.log("Reloading main page."),location.href=location.origin)}},t.prototype.attachLocalStream=function(){try{this.localVideo.srcObject=this.localStream,d.Util.isMobile()||d.Util.isEdgeHTML()||this.shareScreenButton.enableSharingState()}catch(e){C.Log.log("Unable to attach stream to video element.")}if(this.activate(this.localVideo),this.show(this.icons),this.show(this.fullscreenIcon),0===this.localStream.getVideoTracks().length){var e=a.HTMLUtils.get(b.UIConstants.muteVideoSvg);this.hide(e)}if(0===this.localStream.getAudioTracks().length){var t=a.HTMLUtils.get(b.UIConstants.muteAudioSvg);this.hide(t)}},t.prototype.hangup=function(){C.Log.log("AppController::hangup (true, from WS)"),this.hide(this.icons),this.transitionToDone(),this.mediaCommunication.hangupCall(!0),document.onkeypress=null,window.onmousemove=null},t.prototype.sendTextChatMessageButtonClickHandler=function(){var e=this.textChatInput.value.trim().replace(/(\r\n|\n|\r)/gm,"");p.StringUtils.isNotEmpty(e)&&(this.addLocalMessageHTML(e),this.mediaCommunication.sendLocalChatMessage(e),this.textChatInput.value="",this.textChatInput.focus())},t.prototype.onNewRoomClick=function(){location.href=location.origin},t.prototype.onRejoinClick=function(){this.deactivate(this.rejoinDiv),this.hide(this.rejoinDiv),this.mediaCommunication.restartCall()},t.prototype.setupUI=function(){var e=this;this.iconEventSetup(),window.addEventListener("mousemove",(function(){e.showIcons()})),this.overlayDiv.addEventListener("mousemove",(function(){e.showIcons()})),this.overlayDiv.addEventListener("click",(function(){e.showIcons()})),document.addEventListener("touchstart",(function(){e.showIcons()})),document.addEventListener("click",(function(){e.showIcons()})),a.HTMLUtils.get(b.UIConstants.muteAudioSvg).addEventListener("click",(function(){e.toggleAudioMute()})),a.HTMLUtils.get(b.UIConstants.muteVideoSvg).addEventListener("click",(function(){e.toggleVideoMute()})),a.HTMLUtils.get(b.UIConstants.hangupSvg).addEventListener("click",(function(){C.Log.log("hangup click"),e.hangup(),e.shareScreenButton.disableSharingState(),e.closeFullScreen()})),d.Util.setUpFullScreen()},t.prototype.toggleAudioUnMute=function(){this.mediaCommunication.toggleAudioUnMute(),this.muteAudioIconSet.enable()},t.prototype.toggleAudioMute=function(){this.mediaCommunication.toggleAudioMute(),this.muteAudioIconSet.toggle()},t.prototype.toggleVideoMute=function(){this.mediaCommunication.toggleVideoMute(),this.muteVideoIconSet.toggle()},t.prototype.closeFullScreen=function(){var e=a.HTMLUtils.get(".footer"),t=a.HTMLUtils.list(".video-columns-wrap, .videos-wrap, .remote-video-wrap");e.classList.remove("hidden"),t.forEach((function(e){e.classList.remove("js-fullscreen")}))},t.prototype.iconEventSetup=function(){var e=this;this.icons.addEventListener("onmouseenter",(function(){window.clearTimeout(e.hideIconsAfterTimeout)})),this.icons.addEventListener("mouseleave",(function(){e.setIconTimeout()}))},t.prototype.setIconTimeout=function(){var e=this;this.hideIconsAfterTimeout&&window.clearTimeout.bind(this,this.hideIconsAfterTimeout),this.hideIconsAfterTimeout=window.setTimeout((function(){e.hideIcons()}),5e3)},t.prototype.onCloseOverlayClick=function(){this.hide(this.overlayWaitingDiv)},t.prototype.onTextChatButtonClick=function(){this.show(this.textChatWindow)},t.prototype.onTextChatCloseButtonClick=function(){this.hide(this.textChatWindow)},t.prototype.onTextChatCollapseButtonClick=function(){this.hide(this.textChatWindow)},t.prototype.onTextChatInputKeyUp=function(e){var t=this.textChatInput.value.trim().replace(/(\r\n|\n|\r)/gm,"");13===e.keyCode&&t.length>0&&(this.addLocalMessageHTML(t),this.mediaCommunication.sendLocalChatMessage(t),this.textChatInput.value="")},t.prototype.onRemoteClientRegistered=function(e){C.Log.log("AppCntroller::onRemoteClientRegistered",e),this.remoteVideos.addRemoteVideo(e)},t.prototype.onRemoteTextChatMessage=function(e){this.show(this.textChatWindow),this.addRemoteMessageHTML(e)},t.prototype.addRemoteMessageHTML=function(e){var t=h.HTMLTemplates.getRemoteMessageHTML(e);this.textChatMessageList.insertAdjacentHTML("beforeend",t),this.textChatMessageList.scrollTop=this.textChatMessageList.scrollHeight-this.textChatMessageList.clientHeight},t.prototype.addLocalMessageHTML=function(e){var t=h.HTMLTemplates.getLocalMessageHTML(e);this.textChatMessageList.insertAdjacentHTML("beforeend",t),this.textChatMessageList.scrollTop=this.textChatMessageList.scrollHeight-this.textChatMessageList.clientHeight},t.prototype.transitionToDone=function(){this.remoteVideos.removeCanPlayHandlers(),this.deactivate(this.localVideo),this.remoteVideos.deactivateAll(),this.deactivate(this.miniVideo),this.hide(this.hangupSvg),this.hide(this.textChatButton),this.hide(this.textChatWindow),this.activate(this.rejoinDiv),this.show(this.rejoinDiv)},t.prototype.displayError=function(e){C.Log.warn(e)},t.prototype.displaySharingInfo=function(e){var t=e.id,n=e.link;this.roomLink=n=window.location.protocol+"//"+window.location.host+"/r/"+t,this.pushCallNavigation(new m.Room(t,n));var i=/[a-zA-Z0-9]+\-\d+/g.test(t);this.activate(this.sharingDiv),i||this.activate(this.overlayWaitingDiv)},t.prototype.pushCallNavigation=function(e){this.updateInvitationLinks(e.id),window.history.pushState({roomId:e.id,roomLink:e.link},e.id,e.link)},t.prototype.updateInvitationLinks=function(e){var t="https://www.quickhellou.com/r/"+e,n=a.HTMLUtils.get(".overlay--send-invitation__message-editable a");this.roomLinkHref.href=n.href=t,this.roomLinkHref.textContent=n.innerHTML=t,this.roomLinkHrefWaiting.textContent=t,this.roomLinkHrefWaiting.href=t;var i=a.HTMLUtils.get(".invite-waiting-button--sms");d.Util.isMobile()?i.addEventListener("click",(function(){window.open("sms://?body=Please join talk with me:"+t,"_self")})):i.style.display="none"},t.prototype.onRemoteStreamAdded=function(e,t){this.deactivate(this.sharingDiv),this.deactivate(this.overlayWaitingDiv),!d.Util.isMobile()&&d.Util.isEdgeHTML(),this.remoteVideos.addStream(e,t)},t.prototype.onLocalStreamAdded=function(e){C.Log.log("User has granted access to local media."),this.localStream=e,this.attachLocalStream()},t.prototype.onRemoteSdpProtocolReceived=function(e,t,n){t||this.transitionToActive(e),n&&C.Log.log("run display media")},t.prototype.onTransitionToActive=function(e){e.oncanplay=void 0;window.performance.now();if(this.activate(e),this.remoteVideos.updateVideoElementsLayout(),r.BaseUtils.isObjectDefined(this.localVideo.srcObject)){C.Log.log("AppController::onTransitionToActive swapMediaStream.");try{this.miniVideo.srcObject=this.localVideo.srcObject}catch(e){C.Log.warn("Unable to attach stream to video element.",e)}this.activate(this.miniVideo),this.deactivate(this.localVideo);try{this.localVideo.srcObject=null}catch(e){C.Log.warn("Unable to attach stream to video element.",e)}this.activate(this.videosDiv),a.HTMLUtils.get(".videos-wrap").classList.add("active"),this.showActiveConnectionControls(),C.Log.success("Connection established.")}else C.Log.log("AppController::onTransitionToActive: No local video source. Not swapping.")},t.prototype.showActiveConnectionControls=function(){this.show(this.hangupSvg),this.show(this.textChatButton)},t.prototype.transitionToActive=function(e){C.Log.log("AppController::transitionToActive",e);var t=this.remoteVideos.getElement(e);t.oncanplay=void 0;window.performance.now();try{C.Log.log(this.localVideo.srcObject),this.miniVideo.srcObject=this.localVideo.srcObject}catch(e){C.Log.warn("Unable to attach stream to video element.",e)}this.activate(t),this.activate(this.miniVideo),this.deactivate(this.localVideo);try{this.localVideo.srcObject=null}catch(e){C.Log.warn("Unable to attach stream to video element.",e)}this.activate(this.videosDiv),a.HTMLUtils.get(".videos-wrap").classList.add("active"),this.showActiveConnectionControls()},t.prototype.transitionToWaiting=function(){this.hide(this.hangupSvg),this.hide(this.textChatButton),this.hide(this.textChatWindow),this.deactivate(this.videosDiv);try{this.localVideo.srcObject=this.miniVideo.srcObject}catch(e){C.Log.log("Unable to attach stream to video element.",e)}this.activate(this.localVideo),this.remoteVideos.deactivateAll(),this.deactivate(this.miniVideo)},t.prototype.onRemoteHangup=function(e){C.Log.log("The remote side hung up. ",e),this.remoteVideos.removeRemoteVideo(e),this.remoteVideos.isEmpty()&&(this.mediaCommunication.stopSendingDisplayMedia(),this.transitionToWaiting(),this.closeFullScreen())},t.prototype.showIcons=function(){this.icons.classList.contains("active")||(this.activate(this.fullscreenIcon),this.activate(this.icons),this.setIconTimeout())},t.prototype.hideIcons=function(){this.icons.classList.contains("active")&&(this.deactivate(this.icons),this.deactivate(this.fullscreenIcon))},t.prototype.activate=function(e){e.classList.add("active")},t.prototype.initRemoteVideos=function(){this.remoteVideos=g.RemoteVideos.getInstance(),this.remoteVideos.addEventListener(E.RemoteVideosEvent.ADD_STREAM_SUCCESS,this.onTransitionToActive,this)},t}(v.EventDispatcherService);t.AppController=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconSet=void 0;var i=n(3),o=function(){function e(e){this.iconElement=i.HTMLUtils.get(e)}return e.prototype.toggle=function(){this.iconElement.classList.contains("on")?this.iconElement.classList.remove("on"):this.iconElement.classList.add("on")},e.prototype.disable=function(){this.iconElement.classList.contains("on")||this.iconElement.classList.add("on")},e.prototype.enable=function(){this.iconElement.classList.contains("on")&&this.iconElement.classList.remove("on")},e}();t.IconSet=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLTemplates=void 0;var i=function(){function e(){}return e.getRemoteMessageHTML=function(e){return'<div class="text-chat-window__message text-chat-window__message--incoming">\n          <div class="df df-lt text-chat-window__message-content-wrap text-chat-window__message-content-wrap--incoming">\n            <div class="df text-chat-window__message-icon-wrap">\n            </div>\n            <div class="df df-f1 text-chat-window__message-content text-chat-window__message-content--incoming">\n            '+e.trim()+"</div>\n          </div>\n        </div>"},e.getLocalMessageHTML=function(e){return'<div class="text-chat-window__message text-chat-window__message--outgoing">\n        <div class="df df-lt text-chat-window__message-content-wrap text-chat-window__message-content-wrap--outgoing">\n          <div class="df df-c  text-chat-window__message-icon-wrap text-chat-window__message-icon-wrap--outcoming">\n            <img class="text-chat-window__message-icon" src="/images/user.svg" alt="">\n          </div>\n          <div class="df df-f1 text-chat-window__message-content text-chat-window__message-content--outgoing">\n            <div>'+e.trim()+"</div>\n          </div>\n        </div>\n      </div>"},e}();t.HTMLTemplates=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.InvitationView=void 0;var s=n(18),r=n(3),a=n(1),c=function(e){function t(t){var n=e.call(this,t)||this;return n.sendInvitationForm=n.findElement(".send-invitation-form"),n.addFormEvents(),n}return o(t,e),t.prototype.addFormEvents=function(){this.sendInvitationForm.addEventListener("submit",(function(e){e.preventDefault();var t=r.HTMLUtils.get(".send-invitation__email").value,n=r.HTMLUtils.get(".send-invitation__message-editable").innerHTML,i=r.HTMLUtils.get(".send-invitation__error--message");i.classList.add("hidden");var o=r.HTMLUtils.get(".send-invitation__error--email");if(o.classList.add("hidden"),a.StringUtils.isNotEmpty(t)&&a.StringUtils.isNotEmpty(n)){var s=new FormData;s.append("email",t),s.append("subject","Quick Hellou - Invitation"),s.append("message",n.trim()),s.append("dateTime",a.StringUtils.EMPTY),s.append("attachCalendar",a.StringUtils.FALSE);var c=new XMLHttpRequest;c.open("POST","/sendinvitation"),c.addEventListener("load",(function(){r.HTMLUtils.get(".send-invitation__body").classList.add("hidden"),r.HTMLUtils.get(".send-invitation__result").classList.remove("hidden");var e=r.HTMLUtils.get(".send-invitation__result-message");e.classList.remove("js-error"),e.innerHTML=c.responseText})),c.send(s)}else a.StringUtils.isEmpty(n)&&i.classList.remove("hidden"),!a.StringUtils.isEmpty(t)&&a.StringUtils.isEmailValid(t)||o.classList.remove("hidden")}))},t}(s.HTMLComponent);t.InvitationView=c},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ToggleableComponent=void 0;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isEnabled=!0,t}return o(t,e),t.prototype.toggle=function(){this.setIsEnabled(!this.getIsEnabled)},t.prototype.enable=function(){this.setIsEnabled(!0)},t.prototype.disable=function(){this.setIsEnabled(!1)},t.prototype.setIsEnabled=function(e){this.isEnabled=e},t.prototype.getIsEnabled=function(){return this.isEnabled},t}(n(38).Component);t.ToggleableComponent=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var i=n(4),o=function(){function e(){this.service=new i.EventDispatcherService}return e.prototype.addEventListener=function(e,t,n){this.service.addEventListener(e,t,n)},e.prototype.removeEventListener=function(e){this.service.removeEventListener(e)},e.prototype.dispatchEvent=function(e,t){this.service.dispatchEvent(e,t)},e.prototype.destroy=function(){this.service.removeAllEventListeners()},e.prototype.getId=function(){return this.id},e.prototype.setId=function(e){this.id=e},e.prototype.getUid=function(){return this.uid},e.prototype.setUid=function(e){this.uid=e},e}();t.Component=o},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteVideos=void 0;var s=n(3),r=n(40),a=n(4),c=n(2),l=n(19),d=n(0),u=function(e){function t(){var t=e.call(this)||this;return t.isFullScreen=!1,t.videos=new Map,document.addEventListener("fullscreenchange",(function(){t.onFullScreenChange()}),!1),document.addEventListener("webkitfullscreenchange",(function(){t.onFullScreenChange()}),!1),document.addEventListener("mozfullscreenchange",(function(e){t.onFullScreenChange()}),!1),t}return o(t,e),t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.remove=function(e){this.videos.delete(e)},t.prototype.get=function(e){return this.videos.get(e)},t.prototype.getAll=function(){return this.videos},t.prototype.isEmpty=function(){return 0===Array.from(this.videos).length},t.prototype.getElement=function(e){var t=this.videos.get(e);return c.BaseUtils.isObjectDefined(t)?t.element:(d.Log.warn("RemoteVideos::getElement No remote video by given video ID."),null)},t.prototype.waitForRemoteVideo=function(e){var t=this,n=this.videos.get(e),i=n.element;i.readyState>=2?(d.Log.log("Remote video started; currentTime: "+i.currentTime),this.dispatchEvent(l.RemoteVideosEvent.ADD_STREAM_SUCCESS,n.element)):i.oncanplay=function(){t.waitForRemoteVideo(e)}},t.prototype.removeCanPlayHandlers=function(){this.videos.forEach((function(e){e.element.oncanplay=void 0}))},t.prototype.deactivateAll=function(){this.videos.forEach((function(e){e.element.classList.remove("active")})),this.removeAllRemoteVideo()},t.prototype.addRemoteVideo=function(e){d.Log.log("RemoteVideos::addRemoteVideo",e.clientId,e.sessionId),this.add(e.clientId,e.sessionId),this.updateVideoElementsLayout(),this.dispatchEvent(l.RemoteVideosEvent.REMOTE_VIDEO_ADDED)},t.prototype.addStream=function(e,t){var n=this,i=this.get(e);if(c.BaseUtils.isObjectDefined(i)){var o=i.element;if(c.BaseUtils.isObjectDefined(o)){if(c.BaseUtils.isObjectDefined(o.srcObject)||(o.srcObject=t),o.readyState>=2)return d.Log.log("remoteVideoElement success"),void this.dispatchEvent(l.RemoteVideosEvent.ADD_STREAM_SUCCESS,o);setTimeout((function(){n.addStream(e,t)}),2e3)}else this.dispatchEvent(l.RemoteVideosEvent.ADD_STREAM_FAILURE)}else setTimeout((function(){n.addStream(e,t)}),2e3)},t.prototype.removeRemoteVideo=function(e){var t=this.get(e);if(c.BaseUtils.isObjectDefined(t)){t.element.srcObject=null,t.element.oncanplay=void 0,this.remove(e);var n=t.element.parentElement;c.BaseUtils.isObjectDefined(n)&&n.remove(),this.dispatchEvent(l.RemoteVideosEvent.REMOTE_VIDEO_REMOVED)}this.updateVideoElementsLayout()},t.prototype.getRemoteVideoClassName=function(e){return"remote-video--"+e},t.prototype.updateVideoElementsLayout=function(){var e=s.HTMLUtils.list("video.remote-video.active").length;this.videos.forEach((function(t,n){var i=t.element.parentElement;i.classList.remove("size--single","size--double","size--multi");var o="size--single";2===e&&(o="size--double"),e>2&&e<=4&&(o="size--multi"),e>4&&(o="size--large"),i.classList.add(o)}))},t.prototype.add=function(e,t){var n=this,i=this.getRemoteVideoClassName(t);if(s.HTMLUtils.exists(i)&&this.removeRemoteVideo(t),!s.HTMLUtils.exists(i)){var o='<div class="remote-video-wrap '+i+'--wrap">\n        <div class="remote-video-fullscreen '+i+'--fullscreen">\n        </div><div class="video-loader js-active">\n        </div><video class="remote-video '+i+'" autoplay playsinline></video></div>';s.HTMLUtils.get(".videos-wrap").insertAdjacentHTML("afterbegin",o),s.HTMLUtils.get("."+i+"--fullscreen").addEventListener("click",(function(){n.toggleFullScreen("."+i+"--wrap")}),!1)}var a=s.HTMLUtils.get("."+i),c=new r.RemoteVideo(e,a);this.videos.set(t,c);var l=s.HTMLUtils.get("."+i+"--wrap .video-loader");return a.oncanplay=function(){l.classList.remove("js-active"),a.oncanplay=void 0},d.Log.info("RemoteVideos::add Remote video added ",t),c},t.prototype.onFullScreenChange=function(){if(this.isFullScreen){var e=s.HTMLUtils.get(".footer"),t=s.HTMLUtils.list(".video-columns-wrap, .videos-wrap, .remote-video-wrap");e.classList.remove("hidden"),t.forEach((function(e){e.classList.remove("js-fullscreen")})),this.isFullScreen=!1}},t.prototype.toggleFullScreen=function(e){var t=s.HTMLUtils.get(".footer"),n=s.HTMLUtils.list(".video-columns-wrap, .videos-wrap, "+e);this.isFullScreen?(d.Log.log("Exiting fullscreen."),t.classList.remove("hidden"),n.forEach((function(e){e.classList.remove("js-fullscreen")})),this.isFullScreen=!1):(d.Log.log("Entering fullscreen."),t.classList.add("hidden"),n.item(0).classList.add("js-fullscreen"),n.item(1).classList.add("js-fullscreen"),n.item(2).classList.add("js-fullscreen"),this.isFullScreen=!0)},t.prototype.removeAllRemoteVideo=function(){var e=this;this.videos.forEach((function(t,n){e.removeRemoteVideo(n)}))},t}(a.EventDispatcherService);t.RemoteVideos=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteVideo=void 0;var i=function(e,t){this.clientId=e,this.element=t};t.RemoteVideo=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&s[0]?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.MediaCommunication=void 0;var a=n(4),c=n(42),l=n(21),d=n(10),u=n(20),h=n(5),p=n(22),v=n(2),f=n(1),g=n(0),m=n(14),E=n(26),S=n(27),y=n(30),C=n(15),L=function(e){function t(t){var n=e.call(this)||this;return n.loadingParams=t,n.colliderService=l.ColliderService.setupInstance(n.loadingParams.wssUrl,n.loadingParams.wssPostUrl),n.setRoom(n.loadingParams.roomID,n.loadingParams.roomLink),n.colliderService=l.ColliderService.getInstance(),n.colliderService.addEventListener(p.ColliderServiceEvent.MESSAGE,n.onReceiveColliderChannelMessage,n),n.colliderService.addEventListener(p.ColliderServiceEvent.CLOSE,n.onColliderChannelClose,n),n.requestMediaAndIceServers(),n}return o(t,e),t.prototype.setRoom=function(e,t){this.room=new u.Room(e,t),this.loadingParams.roomID=e,this.loadingParams.roomLink=t,this.room.server=this.room.server=window.location.protocol+"//"+window.location.host||""},t.prototype.createCall=function(){return v.BaseUtils.isObjectDefined(this.call)||(this.call=new c.Call(this.loadingParams),this.setupCallEvents()),this.call},t.prototype.connect=function(){var e=this,t=this.colliderService.open().catch((function(t){return e.onError("WebSocket open error: "+t.message),Promise.reject(t)})),n=this.joinRoom().catch((function(t){return e.onError("Room server join error: "+t.message),Promise.reject(t)}));Promise.all([t,n]).then((function(t){var n=t[1];e.loadingParams.clientID=n.client_id;var i=n.sessions,o=new E.SessionInit;i.forEach((function(e){var t=JSON.parse(e);o.addSession(new S.RtcSession(t.id,t.messages,t.other_client_id,f.StringUtils.equals(t.is_initiator,"True"),f.StringUtils.equals(t.is_forward,"True")))})),e.colliderService.register(e.room.id,n.client_id),Promise.all([e.getIceServersPromise,e.getMediaPromise]).then((function(){e.startRtcSignaling(o)})).catch((function(t){e.onError("Failed to start signaling: "+t.message)}))})).catch((function(t){e.onError("WebSocket register error: "+t.message)}))},t.prototype.displayMedia=function(){return s(this,void 0,void 0,(function(){var e=this;return r(this,(function(t){return navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(t){e.onUserDisplayMediaSuccess(t)})).catch((function(t){g.Log.warn(t),e.dispatchEvent(C.ShareScreenEvent.NOT_ALLOWED)})),[2]}))}))},t.prototype.stopSendingDisplayMedia=function(){return s(this,void 0,void 0,(function(){return r(this,(function(e){return this.call.stopDisplayMedia(),[2]}))}))},t.prototype.restartCall=function(){this.requestMediaAndIceServers(),this.connect()},t.prototype.hangupCall=function(e){g.Log.log("MediaCommunication::hangupCall",e),this.call.hangup(e)},t.prototype.toggleAudioUnMute=function(){this.call.toggleAudioUnMute()},t.prototype.toggleAudioMute=function(){this.call.toggleAudioMute()},t.prototype.toggleVideoMute=function(){this.call.toggleVideoMute()},t.prototype.getCallStartTime=function(){return this.call.getStartTime()},t.prototype.sendLocalChatMessage=function(e){this.call.broadcast(m.PeerConnectionResponseType.TEXT_CHAT_MESSAGE,e)},t.prototype.getCall=function(){return this.call},t.prototype.onUserDisplayMediaSuccess=function(e){return s(this,void 0,void 0,(function(){return r(this,(function(t){return v.BaseUtils.isObjectDefined(this.call)?0===e.getTracks().length?(g.Log.error("Display screen has no tracks attached."),[2]):(this.dispatchEvent(y.MediaEvent.DISPLAY_MEDIA_DISPLAYED),this.call.addDisplayMediaTracks(e.getTracks()[0]),[2]):(g.Log.error("Call instance is not defined."),[2])}))}))},t.prototype.requestMediaAndIceServers=function(){this.getMediaPromise=this.maybeGetMedia(),this.getIceServersPromise=this.maybeGetIceServers()},t.prototype.joinRoom=function(){var e=this;return new Promise((function(t,n){v.BaseUtils.isObjectDefined(e.room.id)||n(Error("Missing room ID."));var i=e.room.server+"/join/"+e.room.id+window.location.search;h.Util.sendAsyncUrlRequest("POST",i).then((function(i){var o=h.Util.parseJSON(i);if(o){if(f.StringUtils.equals(o.result,"SUCCESS"))g.Log.log("Joined the room."),t(o.params);else if(n(Error("Registration error: "+o.result)),f.StringUtils.equals(o.result,"FULL")){var s=e.room.server+"/r/"+e.room.id+window.location.search;window.location.assign(s)}}else n(Error("Error parsing response JSON."))})).catch((function(e){n(Error("Failed to join the room: "+e.message))}))}))},t.prototype.maybeGetMedia=function(){var e=this,t=null;if(!1!==this.loadingParams.mediaConstraints.audio||!1!==this.loadingParams.mediaConstraints.video){var n=this.loadingParams.mediaConstraints;t=navigator.mediaDevices.getUserMedia(n).catch((function(e){if("NotFoundError"!==e.name)throw e;return navigator.mediaDevices.enumerateDevices().then((function(e){var t=e.find((function(e){return"videoinput"===e.kind})),i=(e.find((function(e){return"audioinput"===e.kind})),{audio:{echoCancellation:!0},video:t&&n.video});if(navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia(i);g.Log.warn("Feature not supported. Please update your browser to the newest release.")}))})).then((function(t){e.onUserMediaSuccess(t)})).catch((function(t){e.onError("Error getting local media: "+t.message),e.onUserMediaError(t)}))}else t=Promise.resolve();return t},t.prototype.onUserMediaSuccess=function(e){v.BaseUtils.isObjectDefined(this.call)?(this.call.setLocalStream(e),this.dispatchEvent(d.CallEvent.LOCAL_STREAM_ADDED,e)):g.Log.warn("Call instance is not defined.")},t.prototype.onUserMediaError=function(e){var t="Failed to get access to local media. Error name was "+e.name+".Continuing without sending a stream.";this.onError("getUserMedia error: "+t),alert(t)},t.prototype.maybeGetIceServers=function(){var e=this,t=null;if(this.loadingParams.iceServerRequestUrl&&this.loadingParams.iceServerRequestUrl.length>0&&this.loadingParams.peerConnectionConfig.iceServers&&0===this.loadingParams.peerConnectionConfig.iceServers.length){var n=this.loadingParams.iceServerRequestUrl;t=h.Util.requestIceServers(n,this.loadingParams.iceServerTransports).then((function(t){var n=e.loadingParams.peerConnectionConfig.iceServers;e.loadingParams.peerConnectionConfig.iceServers=n.concat(t)})).catch((function(t){e.dispatchEvent(d.CallEvent.STATUS_MESSAGE,"No TURN server; unlikely that media will traverse networks."),g.Log.warn(t.message)}))}else t=Promise.resolve();return t},t.prototype.startRtcSignaling=function(e){this.call.setRoom(this.room),this.call.startRtcSignaling(e)},t.prototype.onReceiveColliderChannelMessage=function(e){var t=h.Util.parseJSON(e);if("string"==typeof t&&(t=h.Util.parseJSON(t)),v.BaseUtils.isObjectDefined(t)){var n=t.type;if(m.PeerConnectionResponseType.isBye(n))this.onRemoteHangup(t.sessionId);else if(m.PeerConnectionResponseType.isPing(n))this.onPingRequest();else if(m.PeerConnectionResponseType.isRemoteIceComplete(n))this.onRemoteIceComplete(t);else if(m.PeerConnectionResponseType.isUnreachableClient(n))this.onUnreachableClient(t.body);else if(m.PeerConnectionResponseType.isTextChatMessage(t))this.onRemoteTextChatMessage(h.Util.parseJSON(t.body));else{if(m.PeerConnectionResponseType.isResponse(n)){var i=t.body;if("string"==typeof t.body&&(i=JSON.parse(t.body)),v.BaseUtils.isObjectDefined(i)){var o=i.name;return void this.resolveResponseSignalingMessage(o,i)}}this.call.receiveColliderChannelMessage(e)}}else g.Log.warn("MediaCommunication::onReceiveColliderChannelMessage No message defined.")},t.prototype.onColliderChannelClose=function(){this.dispatchEvent(d.CallEvent.WEBSOCKET_CLOSED)},t.prototype.onPingRequest=function(){this.colliderService.respondOnPingRequest()},t.prototype.onRemoteIceComplete=function(e){this.call.onRemoteIceComplete(e)},t.prototype.onUnreachableClient=function(e){var t=this.call.onRemoteHangupByClientId(e);this.dispatchEvent(d.CallEvent.REMOTE_HANGUP,t)},t.prototype.setupCallEvents=function(){var e=this;this.call.addEventListener(d.CallEvent.REMOTE_SDP_PROTOCOL_RECEIVED,(function(t){e.onRemoteSdpProtocolReceived(t)}),this),this.call.addEventListener(d.CallEvent.REMOTE_STREAM_ADDED,(function(t){e.onRemoteStreamAdded(t)}),this),this.call.addEventListener(d.CallEvent.LOCAL_STREAM_ADDED,(function(t){e.onLocalStreamAdded(t.stream)}),this),this.call.addEventListener(d.CallEvent.SIGNALING_STATE_CHANGE,(function(){e.dispatchEvent(d.CallEvent.SIGNALING_STATE_CHANGE)}),this),this.call.addEventListener(d.CallEvent.ICE_CONNECTION_STATE_CHANGE,(function(){e.dispatchEvent(d.CallEvent.ICE_CONNECTION_STATE_CHANGE)}),this),this.call.addEventListener(d.CallEvent.NEW_ICE_CANDIDATE,(function(t){e.dispatchEvent(d.CallEvent.NEW_ICE_CANDIDATE,t)}),this),this.call.addEventListener(d.CallEvent.REMOTE_TEXT_CHAT_MESSAGE,(function(t){e.onRemoteTextChatMessage(t.message)}),this),this.call.addEventListener(d.CallEvent.STATUS_MESSAGE,(function(t){e.dispatchEvent(d.CallEvent.STATUS_MESSAGE,t)}),this),this.call.addEventListener(d.CallEvent.ERROR,(function(t){e.dispatchEvent(d.CallEvent.ERROR,t)}),this),this.call.addEventListener(d.CallEvent.CALLER_STARTED,(function(t){e.dispatchEvent(d.CallEvent.CALLER_STARTED,t)}),this),this.call.addEventListener(d.CallEvent.LOCAL_VIDEO_MEDIA_CHANGE,(function(t){e.dispatchEvent(d.CallEvent.LOCAL_VIDEO_MEDIA_CHANGE,t)}),this)},t.prototype.onRemoteHangup=function(e){this.dispatchEvent(d.CallEvent.REMOTE_HANGUP,e),this.call.onRemoteHangup(e)},t.prototype.onRemoteSdpProtocolReceived=function(e){this.dispatchEvent(d.CallEvent.REMOTE_SDP_PROTOCOL_RECEIVED,e)},t.prototype.onRemoteStreamAdded=function(e){this.dispatchEvent(d.CallEvent.REMOTE_STREAM_ADDED,e)},t.prototype.onLocalStreamAdded=function(e){this.dispatchEvent(d.CallEvent.LOCAL_STREAM_ADDED,e)},t.prototype.onRemoteTextChatMessage=function(e){this.dispatchEvent(d.CallEvent.REMOTE_TEXT_CHAT_MESSAGE,e.data)},t.prototype.onRemoteSession=function(e){var t=new E.SessionInit;t.addSession(e.session),this.startRtcSignaling(t)},t.prototype.onRemoteClientRegistered=function(e){var t=this;this.call.setSessionOtherClientId(e).then((function(){t.dispatchEvent(d.CallEvent.REMOTE_CLIENT_REGISTERED,e)})).catch((function(){g.Log.warn("Remote client cannot be registered.")}))},t.prototype.onError=function(e){this.dispatchEvent(d.CallEvent.ERROR,e)},t.prototype.resolveResponseSignalingMessage=function(e,t){switch(e){case"register":this.onRegister(t);break;case"remoteSession":this.onRemoteSession(t);break;case"remoteClientRegistered":this.onRemoteClientRegistered(t)}},t.prototype.onRegister=function(e){f.StringUtils.equals(e.status,"ok")&&g.Log.log("Client has successfully registered in the Collider service.")},t}(a.EventDispatcherService);t.MediaCommunication=L},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&s[0]?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Call=void 0;var a=n(21),c=n(43),l=n(10),d=n(5),u=n(23),h=n(2),p=n(6),v=n(14),f=n(0),g=n(1),m=n(49),E=n(26),S=n(27),y=n(50),C=n(28),L=n(51),_=n(29),R=function(e){function t(t){var n=e.call(this)||this;return n.params=t,n.colliderService=a.ColliderService.getInstance(),n.retryConsumeManagers=new Map,n.pcClients=new Map,n.localStream=null,n.startTime=null,n.cameraTrack=null,n.isCertificateGenerated=!1,n.createCertificate(),n}return o(t,e),t.prototype.send=function(e,t){void 0===t&&(t=!0);var n=JSON.stringify(e);this.colliderService.send(n,t)},t.prototype.broadcast=function(e,t){this.colliderService.broadcast(e,t)},t.prototype.toggleVideoMute=function(){var e=this.localStream.getVideoTracks();if(0!==e.length){f.Log.log("Toggling video mute state.");for(var t=0,n=e;t<n.length;t++){var i=n[t];i.enabled=!i.enabled}f.Log.log("Video "+(e[0].enabled?"unmuted.":"muted."))}else f.Log.log("No local video available.")},t.prototype.addDisplayMediaTracks=function(e){var t=this;this.cameraTrack.enabled=!1,e.addEventListener("ended",(function(){t.stopDisplayMedia()})),this.localStream.getVideoTracks().forEach((function(e){t.localStream.removeTrack(e)})),this.localStream.addTrack(e),this.displayTrack=e,this.dispatchEvent(l.CallEvent.LOCAL_VIDEO_MEDIA_CHANGE,new C.VideoTrackEventOptions(this.displayTrack,C.VideoTrackEventOptions.SCREEN_CAPTURE));try{this.pcClients.forEach((function(e){e.addVideoTrack(t.displayTrack)}))}catch(e){f.Log.log("error",e)}},t.prototype.stopDisplayMedia=function(){this.displayTrack&&this.displayTrack.enabled&&(this.displayTrack.enabled=!1,this.displayTrack.stop(),this.addCameraTracks(),this.dispatchEvent(l.CallEvent.LOCAL_VIDEO_MEDIA_CHANGE,new C.VideoTrackEventOptions(this.cameraTrack)))},t.prototype.toggleAudioUnMute=function(){var e=this.localStream.getAudioTracks();if(0!==e.length){f.Log.log("Toggling audio to unmute state.");for(var t=0,n=e;t<n.length;t++){n[t].enabled=!0}f.Log.log("Audio unmuted.")}else f.Log.log("No local audio available.")},t.prototype.toggleAudioMute=function(){var e=this.localStream.getAudioTracks();if(0!==e.length){f.Log.log("Toggling audio mute state.");for(var t=0,n=e;t<n.length;t++){var i=n[t];i.enabled=!i.enabled}f.Log.log("Audio "+(e[0].enabled?"unmuted.":"muted."))}else f.Log.log("No local audio available.")},t.prototype.getStartTime=function(){return this.startTime},t.prototype.setLocalStream=function(e){this.localStream=e,0!==this.localStream.getVideoTracks().length&&(this.cameraTrack=this.localStream.getVideoTracks().shift())},t.prototype.setRoom=function(e){this.room=e},t.prototype.receiveColliderChannelMessage=function(e){var t=JSON.parse(e),n=t.sessionId;f.Log.log("Call::receiveColliderChannelMessage (should create PC Client) ",n),this.createPcClient(new S.RtcSession(n,"",t)).then((function(e){e.receiveSignalingMessage(t)}))},t.prototype.startRtcSignaling=function(e){var t=this;e.sessions.forEach((function(e){f.Log.log("Call::startRtcSignaling - forward? ",e.isForward),e.isForward?t.forwardNewRtcSession(e):t.startNewRtcSession(e)}))},t.prototype.startNewRtcSession=function(e){var t=this;this.startTime=window.performance.now(),f.Log.log("Start new session with ID: ",e.id),g.StringUtils.isEmpty(e.id)?f.Log.fatal("No sessionId from the remote peer."):this.createPcClient(e).then((function(n){(t.localStream&&n.addStream(t.localStream),e.isInitiator)?t.startupAsInitiator(n):n.startAsReceiver(e.messages)||t.startRetryConsumeManager(n)})).catch((function(e){t.onError("Create PeerConnection exception: "+e)}))},t.prototype.getPeerConnectionStats=function(e,t){var n=this.pcClients.get(t);h.BaseUtils.isObjectDefined(n)},t.prototype.getPeerConnectionStates=function(e){var t=this.pcClients.get(e);return h.BaseUtils.isObjectDefined(t)?t.getPeerConnectionStates():null},t.prototype.hangup=function(e){var t=this;if(this.startTime=null,f.Log.log("Call::hangup",e),this.localStream&&(void 0===this.localStream.getTracks?this.localStream.stop():this.localStream.getTracks().forEach((function(e){e.stop()})),this.localStream=null),h.BaseUtils.isObjectDefined(this.room)){if(h.BaseUtils.isObjectDefined(this.room.id)){this.pcClients.forEach((function(e){e.close()}));var n=[];if(n.push({step:function(){if(t.getLeaveUrl().valid)return f.Log.log("sending leave",t.getLeaveUrl().url),d.Util.sendUrlRequest("POST",t.getLeaveUrl().url,e)},errorString:"Error sending /leave:"}),n.push({step:function(){Array.from(t.pcClients).forEach((function(e){var n=e[1];t.sendToOther(n.getSession().otherClientId,{type:v.PeerConnectionResponseType.BYE,clientId:t.params.clientID,sessionId:n.getSessionId()}),t.pcClients.delete(n.getId())}))},errorString:"Error sending bye:"}),n.push({step:function(){return f.Log.log("close WS collider from hangup ",e),t.colliderService.close(e)},errorString:"Error closing signaling channel:"}),n.push({step:function(){t.params.clientID=null},errorString:"Error setting params:"}),e){for(var i=Promise.resolve(),o=function(e){i=i.then((function(){e.step.call(t)})).catch((function(t){var n;f.Log.log(t,e.errorString),n=e.errorString,f.Log.warn(n)}))},s=0,r=n;s<r.length;s++){o(u=r[s])}return i}for(var a=function(e,t){try{e()}catch(e){f.Log.log(t+" "+e)}},c=0,l=n;c<l.length;c++){var u;a((u=l[c]).step,u.errorString)}return h.BaseUtils.isObjectDefined(this.room.id)||h.BaseUtils.isObjectDefined(this.params.clientID)?f.Log.log("ERROR: sync cleanup tasks did not complete successfully.",this.room.id,this.params.clientID):f.Log.log("Cleanup completed."),Promise.resolve()}f.Log.log("No room ID defined.")}else f.Log.log("No room defined.")},t.prototype.onRemoteHangup=function(e){this.startTime=null;var t=this.pcClients.get(e);if(h.BaseUtils.isObjectDefined(t)){t.close(),this.pcClients.delete(e);var n=new E.SessionInit;n.addSession(new S.RtcSession(t.getSession().id,g.StringUtils.EMPTY,g.StringUtils.EMPTY,!0)),this.startRtcSignaling(n)}else f.Log.warn("Call::onRemoteHangup pcClient identified by sessionId "+e+" doesn't exist.\n        Not initializing new connection.")},t.prototype.onRemoteHangupByClientId=function(e){var t=this,n=g.StringUtils.EMPTY;return Array.from(this.pcClients).forEach((function(i){var o=i[1];o.getSession().otherClientId===e&&(t.onRemoteHangup(o.getSession().id),n=o.getSession().id)})),n},t.prototype.setSessionOtherClientId=function(e){var t=this;return new Promise((function(n,i){var o=t.pcClients.get(e.sessionId);if(f.Log.log("Call::setSessionOtherClientId client?",!!o),h.BaseUtils.isObjectDefined(o)){var s=o.getSession();if(s.otherClientId=e.clientId,o.setSession(s),f.Log.log("Call::setSessionOtherClientId updated"),o.requireDataConsume)t.retryConsumeManagers.get(s.id).next()}else f.Log.log("No client.");n()}))},t.prototype.onRemoteIceComplete=function(e){var t=e.sessionId,n=e.candidates;this.pcClients.get(t).onRemoteIceComplete(n)},t.prototype.consumeRemoteMessages=function(e){e.requireDataConsume=!1,this.colliderService.touch(this.params.roomID,this.params.clientID),this.post("/consume/"+this.params.roomID+"/"+e.getSessionId()+"/"+this.params.clientID).then((function(t){t&&JSON.parse(t).messages.forEach((function(t){f.Log.log("%%% consumeRemoteMessages %%%",t),e.receiveSignalingMessage(t)}))}))},t.prototype.requestSessionUpdate=function(){return s(this,void 0,void 0,(function(){return r(this,(function(e){return[2]}))}))},t.prototype.onLocalIceComplete=function(e){e.session;this.post("/sessions-getter/"+this.params.roomID),f.Log.log("onLocalIceComplete requireDataConsume",e.pcClient.requireDataConsume),e.pcClient.requireDataConsume&&this.startRetryConsumeManager(e.pcClient)},t.prototype.startRetryConsumeManager=function(e){var t=this,n=this.retryConsumeManagers.get(e.getSessionId());h.BaseUtils.isObjectDefined(n)||((n=new L.RetryConsumeManager(this.colliderService,e,this.params.roomID,this.params.clientID)).addEventListener(_.RetryJobEvent.COMPLETE,(function(){f.Log.log("Job complete."),t.retryConsumeManagers.delete(e.getSessionId())}),this),n.start(),this.retryConsumeManagers.set(e.getSessionId(),n))},t.prototype.setLocalVideoTrackAsCamera=function(){this.displayTrack&&this.localStream.removeTrack(this.displayTrack),this.localStream.getTrackById(this.cameraTrack.id)||this.localStream.addTrack(this.cameraTrack)},t.prototype.addCameraTracks=function(){var e=this;this.setLocalVideoTrackAsCamera(),this.pcClients.forEach((function(t){t.addVideoTrack(e.cameraTrack)}))},t.prototype.sendToOther=function(e,t){var n=JSON.stringify(t);this.colliderService.sendToOther(this.params.roomID,this.params.clientID,e,n)},t.prototype.sendResponse=function(e,t){var n={type:"response",body:t};g.StringUtils.isNotEmpty(e)?this.sendToOther(e,n):this.send(n)},t.prototype.startupAsInitiator=function(e){this.hasAnyActiveSession()||this.dispatchEvent(l.CallEvent.CALLER_STARTED,this.room),e.startAsInitiator(this.params.offerOptions)},t.prototype.forwardNewRtcSession=function(e){var t=new y.SessionOptions,n=e.otherClientId;e.isForward=!1,e.otherClientId=this.params.clientID,t.session=e,this.sendResponse(n,t)},t.prototype.createCertificate=function(){var e=this;return new Promise((function(t,n){if(e.isCertificateGenerated)t();else if("function"==typeof RTCPeerConnection.generateCertificate){RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}).then((function(n){f.Log.log("ECDSA certificate generated successfully."),e.params.peerConnectionConfig.certificates=[n],e.isCertificateGenerated=!0,t()})).catch((function(e){f.Log.log("ECDSA certificate generation failed."),n(e)}))}else t()}))},t.prototype.createPcClient=function(e){var t=this;return new Promise((function(n){var i=t.pcClients.get(e.id);if(h.BaseUtils.isObjectDefined(i))return f.Log.log("Call::createPcClient ",e.id,i.requireDataConsume," pc client already exists. resolving."),void n(i);f.Log.log("Call::createPcClient "+e.id+" pc client not exists. creating."),i=new c.PeerConnectionClient(t.params,t.startTime,e),t.pcClients.set(e.id,i),i.init().then((function(){t.addPeerConnectionClientEvents(i),n(i)}))}))},t.prototype.addPeerConnectionClientEvents=function(e){var t=this;e.addEventListener(u.PeerConnectionClientEvent.SIGNALING_MESSAGE,(function(n){f.Log.log("send SIGNALING_MESSAGE",n,e.getSession(),e.ifSendAsPyMessage()),t.sendSignalingMessage(n,e.getSession(),e.ifSendAsPyMessage())}),this),e.addEventListener(u.PeerConnectionClientEvent.REMOTE_SDP_PROTOCOL_RECEIVED,(function(e){t.dispatchEvent(l.CallEvent.REMOTE_SDP_PROTOCOL_RECEIVED,e)}),this),e.addEventListener(u.PeerConnectionClientEvent.REMOTE_STREAM_ADDED,(function(e){t.dispatchEvent(l.CallEvent.REMOTE_STREAM_ADDED,e)}),this),e.addEventListener(u.PeerConnectionClientEvent.SIGNALING_STATE_CHANGE,(function(){t.dispatchEvent(l.CallEvent.SIGNALING_STATE_CHANGE)}),this),e.addEventListener(u.PeerConnectionClientEvent.ICE_CONNECTION_STATE_CHANGE,(function(){t.dispatchEvent(l.CallEvent.ICE_CONNECTION_STATE_CHANGE)}),this),e.addEventListener(u.PeerConnectionClientEvent.NEW_ICE_CANDIDATE,(function(e){t.dispatchEvent(l.CallEvent.NEW_ICE_CANDIDATE,e)}),this),e.addEventListener(u.PeerConnectionClientEvent.ICE_GATHERING_COMPLETE,(function(n){n.pcClient=e,t.onLocalIceComplete(n)}),this),e.addEventListener(u.PeerConnectionClientEvent.ERROR,(function(e){t.onError(e)}),this),e.addEventListener(u.PeerConnectionClientEvent.CREATE_OFFER_SUCCESS,(function(e){var n=new m.RegisterOptions;n.clientId=t.params.clientID,n.sessionId=e.id,n.type="offer",n.uuid=g.StringUtils.uuidv4(),f.Log.log("Call:: sending offer",e.otherClientId,n),t.sendResponse(e.otherClientId,n)}),this),e.addEventListener(u.PeerConnectionClientEvent.CREATE_ANSWER_SUCCESS,(function(e){var n=new m.RegisterOptions;n.clientId=t.params.clientID,n.sessionId=e.id,n.type="answer",n.uuid=g.StringUtils.uuidv4(),""!==e.otherClientId&&(f.Log.log("Call:: sending answer",e.otherClientId,n),t.sendResponse(e.otherClientId,n))}),this)},t.prototype.changeBandwidth=function(e){("chrome"===adapter.browserDetails.browser||"safari"===adapter.browserDetails.browser||"firefox"===adapter.browserDetails.browser&&adapter.browserDetails.version>=64)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&this.pcClients.forEach((function(t){t.changeBandwidth(e)}))},t.prototype.sendSignalingMessage=function(e,t,n){void 0===n&&(n=!1);var i=JSON.stringify(e);if(n){var o=this.room.server;o=(o=g.StringUtils.isNotEmpty(t.id)?o+"/sessionmessage/"+this.room.id+"/"+t.id:o+"/message/"+this.room.id)+"/"+this.params.clientID+window.location.search,this.post(o,i)}else g.StringUtils.isNotEmpty(t.otherClientId)?this.colliderService.sendToOther(this.params.roomID,this.params.clientID,t.otherClientId,i):this.colliderService.send(i)},t.prototype.onError=function(e){this.dispatchEvent(l.CallEvent.ERROR,e)},t.prototype.getLeaveUrl=function(e){return void 0===e&&(e=this.params.clientID),e?{valid:!0,url:this.room.server+"/leave/"+this.room.id+"/"+e}:{valid:!1}},t.prototype.hasAnyActiveSession=function(){var e=!1;return this.pcClients.forEach((function(t){e=e||t.hasActiveRemoteSdp()})),e},t}(p.FormService);t.Call=R},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&s[0]?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PeerConnectionClient=void 0;var a=n(44),c=n(23),l=n(2),d=n(45),u=n(1),h=n(6),p=n(14),v=n(0),f=n(46),g=n(47),m=n(24),E=n(25),S=function(e){function t(t,n,i){var o=e.call(this)||this;return o.requireDataConsume=!1,o.params=t,o.startTime=n,o.identity=new f.PeerConnectionIdentity,o.session=i,o.localIceCandidates=[],o}return o(t,e),t.prototype.init=function(){var e=this;return new Promise((function(t){e.peerConnection=new RTCPeerConnection(e.params.peerConnectionConfig,e.params.peerConnectionConstraints),e.peerConnection.onicecandidate=function(t){e.onIceCandidate(t)},e.peerConnection.ontrack=function(t){e.onRemoteStreamAdded(t)},e.peerConnection.onnegotiationneeded=function(t){return s(e,void 0,void 0,(function(){return r(this,(function(e){return this.renegotiate(),[2]}))}))},e.peerConnection.onsignalingstatechange=function(t){e.onSignalingStateChanged()},e.peerConnection.oniceconnectionstatechange=function(t){e.onIceConnectionStateChanged()},e.peerConnection.onstatsended=function(e){v.Log.log("message",e)},e.peerConnection.onicegatheringstatechange=function(t){"complete"===e.peerConnection.iceGatheringState&&(e.dispatchEvent(c.PeerConnectionClientEvent.ICE_GATHERING_COMPLETE,{session:e.session,candidates:e.localIceCandidates}),e.localIceCandidates=[])},window.dispatchEvent(new CustomEvent("pccreated",{detail:{pc:e,sessionId:e.params.roomID,time:new Date,userId:e.params.roomID+(e.session.isInitiator?"-0":"-1")}})),e.hasRemoteSdp=!1,e.messageQueue=[],e.started=!1,e.statsMonitor=new g.StatsMonitor(e.peerConnection),e.statsMonitor.addEventListener(m.BandwidthLevelUpdateEvent.OUTBOUND_LEVEL_CHANGE,(function(t){e.updateOutboundStream(t.level)}),e),e.statsMonitor.addEventListener(m.BandwidthLevelUpdateEvent.INBOUND_LEVEL_CHANGE,(function(t){e.updateInboundStream(t.level)}),e),e.statsMonitor.run(),t()}))},t.prototype.receiveSignalingMessage=function(e){if(l.BaseUtils.isObjectDefined(e)){var t=e.type;this.session.isInitiator&&p.PeerConnectionResponseType.isAnswer(t)||!this.session.isInitiator&&p.PeerConnectionResponseType.isOffer(t)?(this.hasRemoteSdp=!0,this.messageQueue.unshift(e)):p.PeerConnectionResponseType.isCandidate(t)&&this.messageQueue.push(e),this.drainMessageQueue()}else v.Log.log("Message object is not defined.")},t.prototype.hasActiveRemoteSdp=function(){return this.hasRemoteSdp},t.prototype.addVideoTrack=function(e){l.BaseUtils.isObjectDefined(this.peerConnection)?Promise.all(this.peerConnection.getSenders().map((function(t){if("video"===t.track.kind)try{var n=t.getParameters();n.degradationPreference="maintain-resolution",t.setParameters(n).then((function(){t.replaceTrack(e)}))}catch(e){v.Log.warn("Replace track failure.")}}))):v.Log.error("Peer connection is not defined.")},t.prototype.getPeerConnectionStats=function(e,t){l.BaseUtils.isObjectDefined(this.peerConnection)?this.peerConnection.getStats(e).then(t):v.Log.warn("PeerConnectionClient::getPeerConnectionStats No RTCPeerConnection object.")},t.prototype.addStream=function(e){var t=this;if(!l.BaseUtils.isObjectDefined(this.peerConnection))return null;e.getTracks().forEach((function(n){t.peerConnection.addTrack(n,e)}))},t.prototype.getPeerConnectionStates=function(){return l.BaseUtils.isObjectDefined(this.peerConnection)?{signalingState:this.peerConnection.signalingState,iceGatheringState:this.peerConnection.iceGatheringState,iceConnectionState:this.peerConnection.iceConnectionState}:null},t.prototype.close=function(){l.BaseUtils.isObjectDefined(this.peerConnection)&&(this.peerConnection.close(),window.dispatchEvent(new CustomEvent("pcclosed",{detail:{pc:this,time:new Date}})),this.peerConnection=null,this.statsMonitor.stop())},t.prototype.startAsInitiator=function(e){var n=this;if(v.Log.breakpoint("Start as initiator."),!l.BaseUtils.isObjectDefined(this.peerConnection))return v.Log.log("this.peerConnection not defined. return"),!1;if(this.started)return v.Log.log("already started. return"),!1;this.started=!0;var i=a.SDPUtils.mergeConstraints(t.DEFAULT_SDP_OFFER_OPTIONS,e);return this.peerConnection.createOffer(i).then((function(e){n.setLocalSdpAndNotify(e).then((function(){n.dispatchEvent(c.PeerConnectionClientEvent.CREATE_OFFER_SUCCESS,n.session)}))})).catch((function(e){return n.dispatchEvent(c.PeerConnectionClientEvent.ERROR,"ERROR:createOffer => "+e)})),!0},t.prototype.startAsReceiver=function(e){var t=this;return v.Log.breakpoint("Start as receiver."),!!l.BaseUtils.isObjectDefined(this.peerConnection)&&(!this.started&&(this.started=!0,l.BaseUtils.isObjectDefined(e)&&e.length>0?(e.forEach((function(e){v.Log.log("proceed with initial message",e),t.receiveSignalingMessage(e)})),!0):this.messageQueue.length>0?(v.Log.log("*** have already queued messages so drain them ***"),this.drainMessageQueue(),!0):(v.Log.log("*** requires remote data to consume ***"),this.requireDataConsume=!0,!1)))},t.prototype.getSessionId=function(){return this.session.id},t.prototype.getSession=function(){return this.session},t.prototype.setSession=function(e){this.session=e},t.prototype.ifSendAsPyMessage=function(){return!!this.session.isInitiator&&!u.StringUtils.isNotEmpty(this.session.otherClientId)},t.prototype.getId=function(){return this.session.id},t.prototype.changeBandwidth=function(e){var t=this.peerConnection.getSenders()[0],n=t.getParameters();n.encodings||(n.encodings=[{rid:u.StringUtils.EMPTY}]),"unlimited"===e&&void 0!==n.encodings[0].maxBitrate?delete n.encodings[0].maxBitrate:(n.encodings[0].degradationPreference="maintain-resolution",n.encodings[0].maxBitrate=1e3*Number(e),n.encodings[0].scaleResolutionDownBy=8),n.degradationPreference="maintain-resolution",t.setParameters(n).catch((function(e){return v.Log.error("error",e)}))},t.prototype.onRemoteIceComplete=function(e){v.Log.log("state",this.peerConnection.connectionState),v.Log.log("candidates",e)},t.prototype.updateOutboundStream=function(e){this.changeBandwidth(E.BandwidthLevel.getBitrate(e))},t.prototype.updateInboundStream=function(e){this.changeBandwidth(E.BandwidthLevel.getBitrate(e))},t.prototype.renegotiate=function(){return s(this,void 0,void 0,(function(){return r(this,(function(e){return v.Log.log("Negotiation needed."),[2]}))}))},t.prototype.setRemoteSdp=function(e){var t=this;e.sdp=a.SDPUtils.maybeSetOpusOptions(e.sdp,this.params),e.sdp=a.SDPUtils.maybePreferAudioSendCodec(e.sdp,this.params),e.sdp=a.SDPUtils.maybePreferVideoSendCodec(e.sdp,this.params),e.sdp=a.SDPUtils.maybeSetAudioSendBitRate(e.sdp,this.params),e.sdp=a.SDPUtils.maybeSetVideoSendBitRate(e.sdp,this.params),e.sdp=a.SDPUtils.maybeSetVideoSendInitialBitRate(e.sdp,this.params),e.sdp=a.SDPUtils.maybeRemoveVideoFec(e.sdp,this.params),this.peerConnection.setRemoteDescription(new RTCSessionDescription(e)).then((function(){t.onSetRemoteDescriptionSuccess()})).catch((function(e){t.dispatchEvent(c.PeerConnectionClientEvent.ERROR,"setRemoteDescription")}))},t.prototype.onSetRemoteDescriptionSuccess=function(){var e=this.getRemoteStreams(),t=e.length>0,n=t&&e[0].getVideoTracks().length>0,i=t&&e[0].getVideoTracks().length>1;this.dispatchEvent(c.PeerConnectionClientEvent.REMOTE_SDP_PROTOCOL_RECEIVED,{isRemoteDisplayMediaAvailable:i,isRemoteVideoPlaybackAvailable:n,sessionId:this.session.id}),v.Log.log("Remote session description setting complete.")},t.prototype.processSignalingMessage=function(e){var t=this;return new Promise((function(n,i){if(v.Log.info("====> processSignalingMessage",e),e.type===p.PeerConnectionResponseType.OFFER&&!t.session.isInitiator)return"stable"!==t.peerConnection.signalingState?(v.Log.warn("Remote offer received in unexpected state:\n           "+t.peerConnection.signalingState),void n()):(t.setRemoteSdp(e),t.doAnswer(),void n());if(e.type===p.PeerConnectionResponseType.ANSWER&&t.session.isInitiator)return"have-local-offer"!==t.peerConnection.signalingState?(v.Log.warn("Remote answer received in unexpected state:\n          "+t.peerConnection.signalingState),void n()):(t.setRemoteSdp(e),void n());if("candidate"===e.type){var o=new RTCIceCandidate({candidate:e.candidate,sdpMLineIndex:e.label});return v.Log.fatal("Remote ICE candidate"),t.recordIceCandidate("Remote",o),t.peerConnection.addIceCandidate(o).then((function(){v.Log.log("Remote candidate added successfully.")})).catch((function(e){t.dispatchEvent(c.PeerConnectionClientEvent.ERROR,"ERROR:addIceCandidate => "+e)})),void n()}v.Log.warn("Unexpected message: "+JSON.stringify(e)),i(JSON.stringify(e))}))},t.prototype.drainMessageQueue=function(){return s(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:if(v.Log.info("drainMessageQueue",this.started,this.hasRemoteSdp),!this.peerConnection||!this.started||!this.hasRemoteSdp)return[2];e.label=1;case 1:return this.messageQueue.length>0?[4,this.processSignalingMessage(this.messageQueue.shift())]:[3,3];case 2:return e.sent(),[3,1];case 3:return this.requireDataConsume=!1,this.messageQueue=[],[2]}}))}))},t.prototype.doAnswer=function(){var e=this;this.peerConnection.createAnswer().then((function(t){e.setLocalSdpAndNotify(t).then((function(){e.dispatchEvent(c.PeerConnectionClientEvent.CREATE_ANSWER_SUCCESS,e.session)}))})).catch((function(t){e.dispatchEvent(c.PeerConnectionClientEvent.ERROR,"ERROR:createAnswer => "+t)}))},t.prototype.setLocalSdpAndNotify=function(e){var t=this;return new Promise((function(n){e.sdp=a.SDPUtils.maybePreferAudioReceiveCodec(e.sdp,t.params),e.sdp=a.SDPUtils.maybePreferVideoReceiveCodec(e.sdp,t.params),e.sdp=a.SDPUtils.maybeSetAudioReceiveBitRate(e.sdp,t.params),e.sdp=a.SDPUtils.maybeSetVideoReceiveBitRate(e.sdp,t.params),e.sdp=a.SDPUtils.maybeRemoveVideoFec(e.sdp,t.params),a.SDPUtils.isSendRecv(e.sdp)?t.identity.localSessionId=a.SDPUtils.getMsid(e.sdp).replace(/\{|\}/g,""):v.Log.warn("No local stream is added to the peer connection."),t.peerConnection.setLocalDescription(e).then((function(){v.Log.log("PeerConnectionClient::setLocalSdpAndNotify Set session description success.")})).catch((function(e){t.dispatchEvent(c.PeerConnectionClientEvent.ERROR,"ERROR::setLocalDescription => "+e)})),t.dispatchEvent(c.PeerConnectionClientEvent.SIGNALING_MESSAGE,{sdp:e.sdp,type:e.type,sessionId:t.session.id}),n()}))},t.prototype.recordIceCandidate=function(e,t){this.dispatchEvent(c.PeerConnectionClientEvent.NEW_ICE_CANDIDATE,{candidate:t.candidate,location:e}),"Local"===e&&this.localIceCandidates.push(t)},t.prototype.onSignalingStateChanged=function(){l.BaseUtils.isObjectDefined(this.peerConnection)&&(v.Log.log("PeerConnectionClient::onSignalingStateChanged Signaling state changed to: "+this.peerConnection.signalingState),this.dispatchEvent(c.PeerConnectionClientEvent.SIGNALING_STATE_CHANGE))},t.prototype.onIceConnectionStateChanged=function(){l.BaseUtils.isObjectDefined(this.peerConnection)&&(v.Log.log("PeerConnectionClient::onSignalingStateChanged ICE connection state changed to: "+this.peerConnection.iceConnectionState),u.StringUtils.equals(this.peerConnection.iceConnectionState,"completed")&&v.Log.log("ICE complete time: "+(window.performance.now()-this.startTime).toFixed(0)+"ms."),this.dispatchEvent(c.PeerConnectionClientEvent.ICE_CONNECTION_STATE_CHANGE))},t.prototype.onIceCandidate=function(e){if(e.candidate){if(this.filterIceCandidate(e.candidate)){var t={type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate,sessionId:this.session.id};v.Log.breakpoint("Local ICE candidate"),this.dispatchEvent(c.PeerConnectionClientEvent.SIGNALING_MESSAGE,t),this.recordIceCandidate("Local",e.candidate)}}else v.Log.log("End of candidates.")},t.prototype.filterIceCandidate=function(e){var t=e.candidate;return-1===t.indexOf(d.Constants.TCP)&&!(u.StringUtils.equals(this.params.peerConnectionConfig.iceTransports,d.Constants.RELAY)&&!u.StringUtils.equals(a.SDPUtils.iceCandidateType(t),d.Constants.RELAY))},t.prototype.onRemoteStreamAdded=function(e){if(v.Log.log("onRemoteStreamAdded",e),e&&"track"===e.type){var t=e.streams[0];v.Log.log("onRemoteStreamAdded pass ",this.session.id,t),this.dispatchEvent(c.PeerConnectionClientEvent.REMOTE_STREAM_ADDED,{sessionId:this.session.id,stream:t})}else v.Log.log("onRemoteStreamAdded return ")},t.prototype.getRemoteStreams=function(){var e=new MediaStream;return this.peerConnection.getReceivers().forEach((function(t){e.addTrack(t.track)})),e.onremovetrack=function(){v.Log.log("Track removed.")},[e]},t.DEFAULT_SDP_OFFER_OPTIONS={offerToReceiveAudio:1,offerToReceiveVideo:1,voiceActivityDetection:!1},t}(h.FormService);t.PeerConnectionClient=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SDPUtils=void 0;var i=n(0),o=n(1),s=function(){function e(){}return e.mergeConstraints=function(e,t){if(!e||!t)return e||t;for(var n=e,i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];n[s]=t[s]}return n},e.iceCandidateType=function(e){return e.split(" ")[7]},e.maybeSetOpusOptions=function(e,t){return"true"===t.opusStereo?e=this.setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=this.removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=this.setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=this.removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=this.setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=this.removeCodecParam(e,"opus/48000","usedtx")),t.opusMaxPbr&&(e=this.setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e},e.maybeSetAudioSendBitRate=function(e,t){return t.audioSendBitrate?(i.Log.log("Prefer audio send bitrate: "+t.audioSendBitrate),this.preferBitRate(e,t.audioSendBitrate,"audio")):e},e.maybeSetAudioReceiveBitRate=function(e,t){return t.audioRecvBitrate?(i.Log.log("Prefer audio receive bitrate: "+t.audioRecvBitrate),this.preferBitRate(e,t.audioRecvBitrate,"audio")):e},e.maybeSetVideoSendBitRate=function(e,t){return t.videoSendBitrate?(i.Log.log("Prefer video send bitrate: "+t.videoSendBitrate),this.preferBitRate(e,t.videoSendBitrate,"video")):e},e.maybeSetVideoReceiveBitRate=function(e,t){return t.videoRecvBitrate?(i.Log.log("Prefer video receive bitrate: "+t.videoRecvBitrate),this.preferBitRate(e,t.videoRecvBitrate,"video")):e},e.preferBitRate=function(e,t,n){var o=e.split("\r\n"),s=this.findLine(o,"m=",n);if(null===s)return i.Log.log("Failed to add bandwidth line to sdp, as no m-line found"),e;var r=this.findLineInRange(o,s+1,-1,"m=");null===r&&(r=o.length);var a=this.findLineInRange(o,s+1,r,"c=");if(null===a)return i.Log.log("Failed to add bandwidth line to sdp, as no c-line found"),e;var c=this.findLineInRange(o,a+1,r,"b=AS");c&&o.splice(c,1);var l="b=AS:"+t;return o.splice(a+1,0,l),e=o.join("\r\n")},e.maybeSetVideoSendInitialBitRate=function(e,t){var n=Number(t.videoSendInitialBitrate);if(!n)return e;var o=n,s=Number(t.videoSendBitrate);s&&(n>s&&(i.Log.log("Clamping initial bitrate to max bitrate of "+s+" kbps."),n=s,t.videoSendInitialBitrate=n),o=s);var r=e.split("\r\n"),a=this.findLine(r,"m=","video");if(null===a)return i.Log.log("Failed to find video m-line"),e;var c=r[a],l=new RegExp("m=video\\s\\d+\\s[A-Z/]+\\s"),d=c.split(l)[1].split(" ")[0],u=r[this.findLine(r,"a=rtpmap",d)].split("a=rtpmap:"+d)[1].split("/")[0],h=t.videoSendCodec||u;return e=this.setCodecParam(e,h,"x-google-min-bitrate",t.videoSendInitialBitrate.toString()),e=this.setCodecParam(e,h,"x-google-max-bitrate",o.toString())},e.removePayloadTypeFromMline=function(e,t){e=e.split(" ");for(var n=0;n<e.length;++n)e[n]===t.toString()&&e.splice(n,1);return e.join(" ")},e.getMsid=function(e){var t=e.split("\r\n"),n=this.findLine(t,"a=msid:");return null===n?o.StringUtils.EMPTY:t[n].match(new RegExp("a=msid:[a-z0-9A-Z{}-]+"))[0].replace(/a=msid:/,"")},e.isSendRecv=function(e){var t=e.split("\r\n");return null!==this.findLine(t,"a=sendrecv")},e.removeCodecByName=function(e,t){var n=this.findLine(e,"a=rtpmap",t);if(null===n)return e;var i=this.getCodecPayloadTypeFromLine(e[n]);e.splice(n,1);var o=this.findLine(e,"m=","video");return null===o||(e[o]=this.removePayloadTypeFromMline(e[o],i)),e},e.removeCodecByPayloadType=function(e,t){var n=this.findLine(e,"a=rtpmap",t.toString());if(null===n)return e;e.splice(n,1);var i=this.findLine(e,"m=","video");return null===i||(e[i]=this.removePayloadTypeFromMline(e[i],t)),e},e.maybeRemoveVideoFec=function(e,t){if("false"!==t.videoFec)return e;var n=e.split("\r\n"),i=this.findLine(n,"a=rtpmap","red");if(null===i)return e;var o=this.getCodecPayloadTypeFromLine(n[i]);if(n=this.removeCodecByPayloadType(n,o),n=this.removeCodecByName(n,"ulpfec"),null===(i=this.findLine(n,"a=fmtp",o.toString())))return e;var s=this.parseFmtpLine(n[i]).pt;return null===s?e:(n.splice(i,1),(n=this.removeCodecByPayloadType(n,s)).join("\r\n"))},e.maybePreferAudioSendCodec=function(e,t){return this.maybePreferCodec(e,"audio","send",t.audioSendCodec)},e.maybePreferAudioReceiveCodec=function(e,t){return this.maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},e.maybePreferVideoSendCodec=function(e,t){return this.maybePreferCodec(e,"video","send",t.videoSendCodec)},e.maybePreferVideoReceiveCodec=function(e,t){return this.maybePreferCodec(e,"video","receive",t.videoRecvCodec)},e.maybePreferCodec=function(e,t,n,o){var s=t+" "+n+" codec";if(!o)return i.Log.log("No preference on "+s+"."),e;i.Log.log("Prefer "+s+": "+o);var r=e.split("\r\n"),a=this.findLine(r,"m=",t);if(null===a)return e;var c=this.getCodecPayloadType(r,o);return c&&(r[a]=this.setDefaultCodec(r[a],c)),e=r.join("\r\n")},e.setCodecParam=function(e,t,n,i){var o=e.split("\r\n"),s=this.findFmtpLine(o,t),r={};if(null===s){var a=this.findLine(o,"a=rtpmap",t);if(null===a)return e;var c=this.getCodecPayloadTypeFromLine(o[a]);r.pt=c.toString(),r.params={},r.params[n]=i,o.splice(a+1,0,this.writeFmtpLine(r))}else(r=this.parseFmtpLine(o[s])).params[n]=i,o[s]=this.writeFmtpLine(r);return e=o.join("\r\n")},e.removeCodecParam=function(e,t,n){var i=e.split("\r\n"),o=this.findFmtpLine(i,t);if(null===o)return e;var s=this.parseFmtpLine(i[o]);delete s.params[n];var r=this.writeFmtpLine(s);return null===r?i.splice(o,1):i[o]=r,e=i.join("\r\n")},e.parseFmtpLine=function(e){var t={},n=e.indexOf(" "),i=e.substring(n+1).split(";"),o=new RegExp("a=fmtp:(\\d+)"),s=e.match(o);if(!s||2!==s.length)return null;t.pt=s[1];for(var r={},a=0,c=Object.keys(i);a<c.length;a++){var l=c[a];2===l.length&&(r[l[0]]=l[1])}return t.params=r,t},e.writeFmtpLine=function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;for(var t=e.pt,n=e.params,i=[],o=0,s=0,r=Object.keys(n);s<r.length;s++){var a=r[s];i[o]=a+"="+n[a],++o}return 0===o?null:"a=fmtp:"+t.toString()+" "+i.join(";")},e.findFmtpLine=function(e,t){var n=this.getCodecPayloadType(e,t);return n?this.findLine(e,"a=fmtp:"+n.toString()):null},e.findLine=function(e,t,n){return this.findLineInRange(e,0,-1,t,n)},e.findLineInRange=function(e,t,n,i,o){for(var s=-1!==n?n:e.length,r=t;r<s;++r)if(0===e[r].indexOf(i)&&(!o||-1!==e[r].toLowerCase().indexOf(o.toLowerCase())))return r;return null},e.getCodecPayloadType=function(e,t){var n=this.findLine(e,"a=rtpmap",t);return n?this.getCodecPayloadTypeFromLine(e[n]):null},e.getCodecPayloadTypeFromLine=function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null},e.setDefaultCodec=function(e,t){var n=e.split(" "),i=n.slice(0,3);i.push(t);for(var o=3;o<n.length;o++)n[o]!==t&&i.push(n[o]);return i.join(" ")},e}();t.SDPUtils=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0;var i=function(){function e(){}return e.WS_ACTION="ws",e.XHR_ACTION="xhr",e.QUEUEADD_ACTION="addToQueue",e.QUEUECLEAR_ACTION="clearQueue",e.EVENT_ACTION="event",e.WS_CREATE_ACTION="create",e.WS_EVENT_ONERROR="onerror",e.WS_EVENT_ONMESSAGE="onmessage",e.WS_EVENT_ONOPEN="onopen",e.WS_EVENT_ONCLOSE="onclose",e.WS_EVENT_SENDERROR="onsenderror",e.WS_SEND_ACTION="send",e.WS_CLOSE_ACTION="close",e.TCP="tcp",e.RELAY="relay",e}();t.Constants=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PeerConnectionIdentity=void 0;var i=function(){};t.PeerConnectionIdentity=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.StatsMonitor=void 0;var s=n(4),r=n(0),a=n(48),c=n(24),l=n(25),d=function(e){function t(t){var n=e.call(this)||this;return n.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n.getStatsResult={audio:{send:{tracks:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,packetsLost:0},video:{send:{tracks:[],availableBandwidth:0,availableBandwidthMA:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],availableBandwidth:0,availableBandwidthMA:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,packetsLost:0},bandwidth:{availableOutgoingBitrate:0,availableIncomingBitrate:0,actualEncBitrate:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},framesPerSecond:0,internal:{audio:{send:{},recv:{}},video:{send:{prevBytesSent:0,prevFramerateMean:0,prevBitrateMean:0,ema:0},recv:{prevBytesReceived:0}}}},n.peerConnection=t,n.inboundBandwidthMA=new a.MovingAverage(5),n.outboundBandwidthMA=new a.MovingAverage(5),n.inboundBandwidthLevel=l.BandwidthLevel.HIGH,n.outboundBandwidthLevel=l.BandwidthLevel.HIGH,n}return o(t,e),t.prototype.run=function(){var e=this;setTimeout((function(){e.monitorInterval=window.setInterval((function(){e.monitorCycle()}),1e3)}),1e4)},t.prototype.stop=function(){window.clearInterval(this.monitorInterval)},t.prototype.monitorCycle=function(){var e=this;if(!this.peerConnection)return r.Log.log("No peer connection. Stopping monitor."),void this.stop();this.peerConnection.getStats().then((function(t){var n=[];t.forEach((function(e){n.push(e)})),e.processReportResults(n)})),this.getBandwidth(),this.distributeBandwidthEvents(this.getStatsResult.video)},t.prototype.distributeBandwidthEvents=function(e){var t=e.send.availableBandwidthMA;l.BandwidthLevel.isLow(t)&&this.outboundBandwidthLevel!==l.BandwidthLevel.LOW&&(this.outboundBandwidthLevel=l.BandwidthLevel.LOW,this.dispatchEvent(c.BandwidthLevelUpdateEvent.OUTBOUND_LEVEL_CHANGE,{level:l.BandwidthLevel.LOW})),l.BandwidthLevel.isMedium(t)&&this.outboundBandwidthLevel!==l.BandwidthLevel.MEDIUM&&(this.outboundBandwidthLevel=l.BandwidthLevel.MEDIUM,this.dispatchEvent(c.BandwidthLevelUpdateEvent.OUTBOUND_LEVEL_CHANGE,{level:l.BandwidthLevel.MEDIUM})),l.BandwidthLevel.isHigh(t)&&this.outboundBandwidthLevel!==l.BandwidthLevel.HIGH&&(this.outboundBandwidthLevel=l.BandwidthLevel.HIGH,this.dispatchEvent(c.BandwidthLevelUpdateEvent.OUTBOUND_LEVEL_CHANGE,{level:l.BandwidthLevel.HIGH}))},t.prototype.processReportResults=function(e){var t=this;e&&e.forEach&&e.forEach((function(e){t.processReportResult(e)}))},t.prototype.processReportResult=function(e){this.checkAudio(e),this.checkVideo(e)},t.prototype.checkAudio=function(e){var t;if(!(e.mediaType&&"audio"!==e.mediaType||e.kind&&"audio"!==e.kind)&&(!0!==e.isRemote&&void 0===e.bytesReceived||(t="recv"),!1!==e.isRemote&&void 0===e.bytesSent||(t="send"),t)){if(e.bytesSent){var n=0;this.getStatsResult.internal.audio[t].prevBytesSent||(this.getStatsResult.internal.audio[t].prevBytesSent=e.bytesSent);var i=e.bytesSent-this.getStatsResult.internal.audio[t].prevBytesSent;this.getStatsResult.internal.audio[t].prevBytesSent=e.bytesSent,n=i/1024,this.getStatsResult.audio[t].availableBandwidth=n.toFixed(1),this.getStatsResult.audio.bytesSent=n.toFixed(1)}if(e.bytesReceived){n=0;this.getStatsResult.internal.audio[t].prevBytesReceived||(this.getStatsResult.internal.audio[t].prevBytesReceived=e.bytesReceived);i=e.bytesReceived-this.getStatsResult.internal.audio[t].prevBytesReceived;this.getStatsResult.internal.audio[t].prevBytesReceived=e.bytesReceived,n=i/1024,this.getStatsResult.audio.bytesReceived=n.toFixed(1)}if(e.packetsLost){this.getStatsResult.internal.audio.prevPacketsLost||(this.getStatsResult.internal.audio.prevPacketsLost=e.packetsLost);i=e.packetsLost-this.getStatsResult.internal.audio.prevPacketsLost;this.getStatsResult.internal.audio.prevPacketsLost=e.packetsLost,this.getStatsResult.audio.packetsLost=i.toFixed(1),this.getStatsResult.audio.packetsLost<0&&(this.getStatsResult.audio.packetsLost=0)}}},t.prototype.checkVideo=function(e){if(!(e.mediaType&&"video"!==e.mediaType||e.kind&&"video"!==e.kind)){var t=e.id.split("_").pop();!0!==e.isRemote&&void 0===e.bytesReceived||(t="recv"),!1!==e.isRemote&&void 0===e.bytesSent||(t="send"),t&&(this.getTrack(e),this.getMediaSource(e),this.getDataSentReceived(e),this.getInboundRtp(e),this.getOutboundRtp(e))}},t.prototype.getMediaSource=function(e){"media-source"===e.type&&(this.getStatsResult.framesPerSecond=e.framesPerSecond)},t.prototype.getTrack=function(e){if("track"===e.type){var t=!0===e.remoteSource?"send":"recv";e.frameWidth&&e.frameHeight&&(this.getStatsResult.resolutions[t].width=e.frameWidth,this.getStatsResult.resolutions[t].height=e.frameHeight)}},t.prototype.getInboundRtp=function(e){if("inbound-rtp"===e.type){var t=e.mediaType||"audio";if(e.bytesReceived){var n=e.bytesReceived,i=(n-this.getStatsResult.internal[t].recv.prevBytesReceived)/1024;this.getStatsResult[t].recv.availableBandwidth=i.toFixed(1),this.getStatsResult[t].recv.availableBandwidthMA=this.inboundBandwidthMA.update(i),this.getStatsResult.internal[t].recv.prevBytesReceived=n,this.getStatsResult[t].bytesReceived=i.toFixed(1)}}},t.prototype.getOutboundRtp=function(e){if("outbound-rtp"===e.type){var t=e.mediaType||"audio",n=e.isRemote?"recv":"send";if(n){if(e.bytesSent){var i=e.bytesSent,o=(s=i-this.getStatsResult.internal[t].send.prevBytesSent)/1024;this.getStatsResult[t].send.availableBandwidth=o.toFixed(1),this.getStatsResult[t].send.availableBandwidthMA=this.outboundBandwidthMA.update(o),this.getStatsResult.internal[t].send.prevBytesSent=i,this.getStatsResult[t].bytesSent=o.toFixed(1),e.retransmittedBytesSent&&(this.getStatsResult.bandwidth.actualEncBitrate=e.bytesSent-e.retransmittedBytesSent)}if(e.bytesReceived){o=0;this.getStatsResult.internal[t][n].prevBytesReceived||(this.getStatsResult.internal[t][n].prevBytesReceived=e.bytesReceived);var s=e.bytesReceived-this.getStatsResult.internal[t][n].prevBytesReceived;this.getStatsResult.internal[t][n].prevBytesReceived=e.bytesReceived,o=s/1024,this.getStatsResult[t].bytesReceived=o.toFixed(1)}}}},t.prototype.getDataSentReceived=function(e){"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(this.getStatsResult[e.mediaType].bytesSent=Number(e.bytesSent)),e.bytesReceived&&(this.getStatsResult[e.mediaType].bytesReceived=Number(e.bytesReceived)))},t.prototype.getBandwidth=function(){this.getStatsResult.audio&&this.getStatsResult.video&&(this.getStatsResult.bandwidth.speed=this.getStatsResult.audio.bytesSent-this.getStatsResult.bandwidth.helper.audioBytesSent+(this.getStatsResult.video.bytesSent-this.getStatsResult.bandwidth.helper.videoBytesSent),this.getStatsResult.bandwidth.helper.audioBytesSent=this.getStatsResult.audio.bytesSent,this.getStatsResult.bandwidth.helper.videoBytesSent=this.getStatsResult.video.bytesSent)},t}(s.EventDispatcherService);t.StatsMonitor=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MovingAverage=void 0;var i=function(){function e(e){this.range=e,this.values=Array(2*e).fill(0)}return e.prototype.update=function(e){return this.values.length>2*this.range&&this.values.shift(),this.values.push(e),this.calculate()},e.prototype.calculate=function(){for(var e=this.smooth(this.range),t=this.average(this.values.slice(0,this.range)),n=[this.toFixed(t)],i=this.range;i<this.values.length;i++)t=e*Number(this.values[i])+(1-e)*t,n.push(this.toFixed(t));return n.pop()},e.prototype.average=function(e){for(var t=e.length,n=-1,i=0;++n<t;)i+=Number(e[n]);return i/t},e.prototype.smooth=function(e){return 2/(e+1)},e.prototype.toFixed=function(e){return e.toFixed(2)},e}();t.MovingAverage=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RegisterOptions=void 0;var i=function(){this.name="remoteClientRegistered"};t.RegisterOptions=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionOptions=void 0;var i=function(){this.name="remoteSession"};t.SessionOptions=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryConsumeManager=void 0;var s=n(0),r=n(29),a=n(6),c=n(2),l=function(e){function t(t,n,i,o){var s=e.call(this)||this;return s.status="__init__",s.colliderService=t,s.pcClient=n,s.roomId=i,s.clientId=o,s}return o(t,e),t.prototype.start=function(){s.Log.log("************* start"),this.status="touch",this.doJob()},t.prototype.next=function(){this.status="consume"},t.prototype.doJob=function(){var e=this;s.Log.log("**** status",this.status),this.pcClient.requireDataConsume&&("touch"===this.status?this.touch():"consume"===this.status&&this.consume(),"complete"!==this.status&&setTimeout((function(){e.doJob()}),3e3))},t.prototype.touch=function(){s.Log.log("Touch"),this.colliderService.touch(this.roomId,this.clientId)},t.prototype.consume=function(){var e=this;this.post("/consume/"+this.roomId+"/"+this.pcClient.getSessionId()+"/"+this.clientId).then((function(t){if(t){var n=JSON.parse(t).messages;c.BaseUtils.isObjectDefined(n)&&(n.forEach((function(t){s.Log.log("%%% RETRY CONSUME %%%",t),e.pcClient.receiveSignalingMessage(t)})),n.length>0&&(e.pcClient.requireDataConsume=!1,e.status="complete",e.dispatchEvent(r.RetryJobEvent.COMPLETE)))}}))},t}(a.FormService);t.RetryConsumeManager=l},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenShareButtonComponent=void 0;var s=n(18),r=n(3),a=n(15),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isSharingEnabled=!1,t}return o(t,e),t.prototype.init=function(){this.setupUIEvents()},t.prototype.setupUIEvents=function(){var e=this;this.element.addEventListener("click",(function(){e.dispatchScreenSharingEvent()}))},t.prototype.dispatchScreenSharingEvent=function(){this.isSharingEnabled?(this.dispatchEvent(a.ShareScreenEvent.START_SHARING),this.setStopSharingLabel()):(this.dispatchEvent(a.ShareScreenEvent.STOP_SHARING),this.setStartSharingLabel())},t.prototype.toggleScreenSharingWithFlag=function(e){this.isSharingEnabled?this.setStopSharingLabel():this.setStartSharingLabel(),this.isSharingEnabled=!e},t.prototype.enableSharingState=function(){this.isSharingEnabled=!0,e.prototype.enable.call(this),this.setStartSharingLabel()},t.prototype.disableSharingState=function(){this.isSharingEnabled=!1,e.prototype.disable.call(this),this.setStopSharingLabel()},t.prototype.lock=function(){this.element.classList.add("js-locked")},t.prototype.unlock=function(){this.element.classList.remove("js-locked")},t.prototype.setStartSharingLabel=function(){r.HTMLUtils.get(".button--share-screen__label").innerHTML="Share Screen"},t.prototype.setStopSharingLabel=function(){r.HTMLUtils.get(".button--share-screen__label").innerHTML="Stop Sharing Screen"},t}(s.HTMLComponent);t.ScreenShareButtonComponent=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIConstants=void 0;var i=n(54),o=n(55),s=function(){function e(){}return e.confirmJoinButton=".confirm-join-button",e.confirmJoinDiv=".confirm-join-div",e.confirmJoinRoomSpan=".confirm-join-room-span",e.fullscreenSvg=".fullscreen",e.hangupSvg=".button--hangup",e.icons=".icons",e.infoDiv=".info-div",e.localVideo=".local-video",e.miniVideo=".mini-video",e.muteAudioSvg=".mute-audio",e.muteVideoSvg=".mute-video",e.newRoomButton=".new-room-button",e.remoteVideo=".remote-video",e.textChatButton=".button--chat-window",e.rejoinButton=".rejoin-button",e.rejoinDiv=".rejoin-div",e.roomLinkHref=".room-link-href",e.roomLinkHrefWaiting=".room-link-href-waiting",e.sharingDiv=".sharing-div",e.statusDiv=".status-div",e.videosDiv=".view--videos",e.hellouLogoFooterDiv=".quickhellou-logo-footer",e.overlayDiv=".overlay",e.overlayWaitingDiv=".overlay-waiting",e.closeOverlayButton=".invite-waiting-button--thanks",e.textChat=new i.TextChatUIConstants,e.roomSelection=new o.RoomSelectionUIConstants,e}();t.UIConstants=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextChatUIConstants=void 0;var i=function(){this.chatWindow=".text-chat-window",this.closeButton=".text-chat-window__close",this.collapseButton=".text-chat-window__collapse",this.messageList=".text-chat-window__messages",this.input=".text-chat-window__message-input"};t.TextChatUIConstants=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSelectionUIConstants=void 0;var i=function(){this.div=".room-selection",this.joinButton=".join-button",this.joinCircle=".button--quick-talk"};t.RoomSelectionUIConstants=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingParams=void 0;var i=n(5),o=function(){this.errorMessages=new Array,this.warningMessages=new Array,this.suggestedRoomId=i.Util.randomString(9),this.connect=!1};t.LoadingParams=o}]);